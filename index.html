<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EmiBonnie Memories Ultimate Timeline</title>
    <style>
        :root {
            --emi: #f37021; --bonnie: #662d91;
            --grad: linear-gradient(135deg, #f37021, #662d91);
            --glass: rgba(255, 255, 255, 0.9);
            --violet-bg: #f7f3ff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #fff; font-family: -apple-system, sans-serif; position: relative; }
        body::before { content: "ğŸ¦‹"; position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); font-size: 300px; opacity: 0.08; z-index: 0; pointer-events: none; }

        /* å°èˆª */
        .nav-container { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 92%; max-width: 580px; }
        .main-nav { background: var(--glass); padding: 10px 15px; border-radius: 50px; backdrop-filter: blur(20px); box-shadow: 0 20px 40px rgba(0,0,0,0.08); display: flex; align-items: center; overflow-x: auto; border: 1px solid rgba(255,255,255,0.5); }
        .nav-logo-btn { font-size: 1.8rem; padding-right: 15px; margin-right: 12px; border-right: 1.5px solid #eee; cursor: pointer; }
        .nav-btn { background: transparent; border: none; font-size: 0.9rem; font-weight: 700; color: #555; padding: 10px 14px; flex-shrink: 0; transition: 0.3s; }
        .nav-btn.active-tab { color: var(--emi); transform: translateY(-3px); }

        /* å½ˆçª— */
        .modal { position: fixed; inset: 0; background: #fff; z-index: 500; transform: translateY(100%); transition: 0.5s cubic-bezier(0.25, 1, 0.5, 1); overflow-y: auto; padding-bottom: 120px; }
        .modal.active { transform: translateY(0); }
        .header { position: sticky; top: 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; z-index: 600; border-bottom: 1px solid #f5f5f5; }
        .m-title { font-size: 1.2rem; font-weight: 800; background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* â³ æ™‚é–“è»¸å°ˆå±¬æ¨£å¼ */
        .year-nav { display: flex; gap: 15px; padding: 15px 20px; overflow-x: auto; background: #fafafa; position: sticky; top: 65px; z-index: 590; }
        .year-tab { padding: 8px 18px; border-radius: 20px; background: #eee; font-size: 0.85rem; font-weight: 700; color: #777; white-space: nowrap; }
        .year-tab.active { background: var(--grad); color: #fff; }

        .tl-container { padding: 30px 25px; position: relative; }
        .tl-container::before { content: ''; position: absolute; left: 35px; top: 0; bottom: 0; width: 2px; background: #eee; }
        .tl-item { position: relative; margin-bottom: 40px; padding-left: 45px; }
        .tl-dot { position: absolute; left: 7px; top: 5px; width: 12px; height: 12px; border-radius: 50%; background: var(--emi); border: 3px solid #fff; box-shadow: 0 0 0 3px #eee; z-index: 2; }
        .tl-date { font-size: 0.75rem; font-weight: 800; color: var(--bonnie); margin-bottom: 8px; display: block; }
        .tl-card { background: #fdfdfd; padding: 15px; border-radius: 20px; border: 1px solid #f0f0f0; box-shadow: 0 5px 15px rgba(0,0,0,0.02); }
        .tl-card img { width: 100%; border-radius: 12px; margin-top: 10px; }

        /* å…¶ä»–æ¨¡çµ„èˆ‡ UI */
        .hero { position: fixed; top: 35%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; }
        .eb-logo { font-size: 5rem; font-weight: 900; margin: 0; letter-spacing: 12px; }
        .counters { display: flex; justify-content: center; gap: 30px; margin-top: 25px; }
        .c-num { font-size: 3rem; font-weight: 800; }
        .adm-section { background: #fbfbfb; padding: 20px; border-radius: 25px; margin: 15px; border: 1px solid #f0f0f0; }
        .btn-main { background: var(--grad); color: #fff; border: none; padding: 14px; width: 100%; border-radius: 15px; font-weight: 800; cursor: pointer; }
        input, select, textarea { width: 100%; padding: 12px; margin: 5px 0 12px; border-radius: 12px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="hero">
    <h1 class="eb-logo"><span style="color:var(--emi)">E</span><span style="color:var(--bonnie)">B</span></h1>
    <div class="counters">
        <div class="c-item"><span class="c-num" id="d1">0</span><div style="font-size:0.7rem; color:#999;">è´è¶èª•ç”Ÿ</div></div>
        <div class="c-item"><span class="c-num" id="d2">0</span><div style="font-size:0.7rem; color:#999;">èˆ‡ä½ ç›¸é‡</div></div>
    </div>
</div>

<div class="nav-container">
    <nav class="main-nav">
        <div class="nav-logo-btn" onclick="closeAll()">ğŸ¦‹</div>
        <button class="nav-btn" onclick="openM('m-profile', this)">åç‰Œ</button>
        <button class="nav-btn" onclick="openM('m-timeline', this)">è»Œè·¡</button>
        <button class="nav-btn" onclick="openM('m-works', this)">ä½œå“</button>
        <button class="nav-btn" onclick="openM('m-plans', this)">è¡Œç¨‹</button>
        <button class="nav-btn" onclick="openM('m-diary', this)">æ—¥è¨˜</button>
        <button class="nav-btn" onclick="openM('m-admin', this)" style="color:var(--emi)">ç®¡ç†</button>
    </nav>
</div>

<div id="m-timeline" class="modal">
    <div class="header"><span class="m-title">è´è¶è»Œè·¡ Timeline</span><span onclick="closeAll()">âœ•</span></div>
    <div class="year-nav" id="year-selector"></div>
    <div class="tl-container" id="tl-render"></div>
</div>

<div id="m-profile" class="modal"><div class="header"><span class="m-title">å€‹äººåç‰Œ</span><span onclick="closeAll()">âœ•</span></div><div id="p-render"></div></div>
<div id="m-works" class="modal"><div class="header"><span class="m-title">ä½œå“é›†</span><span onclick="closeAll()">âœ•</span></div><div id="w-render" style="padding:20px" class="grid-2"></div></div>
<div id="m-plans" class="modal"><div class="header"><span class="m-title">è¡Œç¨‹æœˆæ›†</span><span onclick="closeAll()">âœ•</span></div><div id="cal-body"></div></div>
<div id="m-diary" class="modal"><div class="header"><span class="m-title">è´è¶æ—¥è¨˜</span><span onclick="closeAll()">âœ•</span></div><div id="diary-render"></div></div>

<div id="m-admin" class="modal">
    <div class="header"><span class="m-title">ç®¡ç†ä¸­å¿ƒ</span><span onclick="closeAll()">âœ•</span></div>
    
    <div class="adm-section">
        <h4>â³ æ–°å¢æ™‚é–“è»¸å›æ†¶</h4>
        <select id="adm-tl-year"></select>
        <input type="text" id="adm-tl-date" placeholder="æ—¥æœŸ (å¦‚: 03.14)">
        <textarea id="adm-tl-txt" rows="2" placeholder="ç™¼ç”Ÿäº†ä»€éº¼å¥½ç©çš„äº‹ï¼Ÿ"></textarea>
        <input type="file" id="adm-tl-img" accept="image/*">
        <button class="btn-main" onclick="addNewItem('tl')">ç™¼å¸ƒåˆ°è»Œè·¡</button>
    </div>

    <div class="adm-section">
        <h4>ğŸ†• ç®¡ç†å¹´ä»½</h4>
        <div style="display:flex; gap:10px;">
            <input type="number" id="new-year-input" placeholder="2026" style="margin:0">
            <button class="btn-main" style="width:100px" onclick="addYear()">æ–°å¢å¹´ä»½</button>
        </div>
    </div>

    <div class="adm-section">
        <h4>ğŸ—‘ï¸ å…§å®¹åˆªé™¤ (é»æ“Šåœ–ç‰‡åˆªé™¤)</h4>
        <div id="adm-manage-list" style="display:flex; gap:10px; overflow-x:auto;"></div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('eb_v8')) || {
        settings: { born: "2024-01-01", meet: "2024-01-01" },
        years: [2024, 2025],
        timeline: [], works: [], plans: [], diaries: []
    };

    let selectedYear = 2024;

    function save() { localStorage.setItem('eb_v8', JSON.stringify(db)); renderHome(); renderAdminList(); }
    const toBase64 = f => new Promise(r => { if(!f) r(""); const rd=new FileReader(); rd.onload=e=>r(e.target.result); rd.readAsDataURL(f); });

    // --- æ™‚é–“è»¸æ¸²æŸ“ ---
    function renderTimeline() {
        // å¹´ä»½å°èˆª
        document.getElementById('year-selector').innerHTML = db.years.map(y => 
            `<div class="year-tab ${y==selectedYear?'active':''}" onclick="setYear(${y})">${y}</div>`
        ).join('');

        // å…§å®¹
        const filtered = db.timeline.filter(t => t.year == selectedYear);
        document.getElementById('tl-render').innerHTML = filtered.length ? filtered.map(t => `
            <div class="tl-item">
                <div class="tl-dot"></div>
                <span class="tl-date">${t.date}</span>
                <div class="tl-card">
                    <div style="font-size:0.95rem; color:#444;">${t.txt}</div>
                    ${t.img ? `<img src="${t.img}">` : ''}
                </div>
            </div>
        `).join('') : '<p style="text-align:center; color:#ccc; padding:20px;">é€™ä¸€å¹´é‚„åœ¨é†é‡€ç²¾å½©çš„æ•…äº‹...</p>';
    }

    function setYear(y) { selectedYear = y; renderTimeline(); }

    function addYear() {
        const y = parseInt(document.getElementById('new-year-input').value);
        if(y && !db.years.includes(y)) {
            db.years.push(y); db.years.sort();
            save(); updateYearDropdown(); alert("å¹´ä»½å·²æ–°å¢ï¼");
        }
    }

    function updateYearDropdown() {
        document.getElementById('adm-tl-year').innerHTML = db.years.map(y => `<option value="${y}">${y}å¹´</option>`).join('');
    }

    // --- å…§å®¹ç®¡ç† ---
    async function addNewItem(type) {
        if(type === 'tl') {
            const year = document.getElementById('adm-tl-year').value;
            const date = document.getElementById('adm-tl-date').value;
            const txt = document.getElementById('adm-tl-txt').value;
            const file = document.getElementById('adm-tl-img').files[0];
            if(!date || !txt) return alert("è«‹å¡«å¯«æ—¥æœŸèˆ‡å…§å®¹");
            const img = await toBase64(file);
            db.timeline.unshift({ year, date, txt, img });
            document.getElementById('adm-tl-txt').value = "";
        }
        // ... å…¶ä»–é¡å‹çš„ addNewItem é‚è¼¯ (åŒå‰å¹¾ç‰ˆ)
        save(); alert("æ–°å¢æˆåŠŸï¼");
    }

    function renderAdminList() {
        let h = "";
        db.timeline.forEach((t, i) => {
            if(t.img) h += `<img src="${t.img}" style="width:60px;height:60px;object-fit:cover;border-radius:10px;" onclick="del('timeline',${i})">`;
        });
        document.getElementById('adm-manage-list').innerHTML = h || "å°šç„¡åœ–æª”";
    }

    function del(t, i) { if(confirm("åˆªé™¤ï¼Ÿ")) { db[t].splice(i,1); save(); renderTimeline(); } }

    // --- å½ˆçª—åˆ‡æ› ---
    function openM(id, btn) {
        closeAll(); document.getElementById(id).classList.add('active');
        if(btn) btn.classList.add('active-tab');
        if(id === 'm-timeline') renderTimeline();
        if(id === 'm-admin') { updateYearDropdown(); renderAdminList(); }
    }

    function closeAll() {
        document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab'));
    }

    function renderHome() {
        const calc = d => Math.floor((new Date() - new Date(d)) / 86400000);
        document.getElementById('d1').innerText = Math.max(0, calc(db.settings.born));
        document.getElementById('d2').innerText = Math.max(0, calc(db.settings.meet));
    }

    window.onload = () => { renderHome(); updateYearDropdown(); };
</script>
</body>
</html>








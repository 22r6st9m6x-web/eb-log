<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EmiBonnie Butterfly Eternal Archive | THE ULTIMATE VERSION</title>
    
    <style>
        /* ============================================================
           1. è¦–è¦ºç³»çµ±èˆ‡å…¨åŸŸè®Šæ•¸ (Global System Variables)
           ============================================================ */
        :root {
            --emi-primary: #f37021;
            --emi-gradient: linear-gradient(135deg, #f37021, #ff8c4b);
            --bonnie-primary: #662d91;
            --bonnie-gradient: linear-gradient(135deg, #662d91, #8e54bd);
            --any-accent: #ff85a2;
            --glass-bg: rgba(255, 255, 255, 0.96);
            --border-light: 1px solid rgba(0,0,0,0.06);
            --shadow-float: 0 15px 45px rgba(0,0,0,0.1);
            --shadow-inset: inset 0 2px 8px rgba(0,0,0,0.05);
            --radius-main: 25px;
            --radius-round: 50px;
            --transition-main: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        /* ============================================================
           2. åŸºç¤ä½ˆå±€èˆ‡é‡ç½® (Base Layout & Reset)
           ============================================================ */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #ffffff; color: #333333;
            font-family: "PingFang TC", "Hiragino Sans GB", "Microsoft JhengHei", sans-serif;
            overflow: hidden; /* ç”±åˆ†é è‡ªè¡Œè™•ç†æ²å‹• */
        }

        /* èƒŒæ™¯è¿·éœ§è£é£¾ */
        .ambient-glow {
            position: fixed; inset: 0; z-index: 0; pointer-events: none;
            background: radial-gradient(circle at 15% 15%, rgba(243,112,33,0.08), transparent 40%),
                        radial-gradient(circle at 85% 85%, rgba(102,45,145,0.08), transparent 40%);
            filter: blur(40px);
        }

        /* éœæ­¢è´è¶è£é£¾çµ„ä»¶ - å…¨å±•é–‹ CSS */
        .butterfly-asset { position: absolute; z-index: 1; opacity: 0.85; pointer-events: none; }
        .wing-l, .wing-r {
            position: absolute; width: 30px; height: 42px;
            background: linear-gradient(135deg, var(--emi-primary), var(--bonnie-primary));
            border-radius: 50% 60% 10% 60%;
            box-shadow: inset -3px -3px 10px rgba(0,0,0,0.15);
            border: 0.5px solid rgba(255,255,255,0.3);
        }
        .wing-r { left: 28px; border-radius: 60% 50% 60% 10%; transform: scaleX(-1); }
        .b-body { position: absolute; left: 26px; top: 15px; width: 6px; height: 26px; background: #333; border-radius: 10px; }

        /* ============================================================
           3. ä¸»ç•«é¢ D-Day èˆ‡å°è¦½ (Navigation Dock)
           ============================================================ */
        .hero-view {
            position: fixed; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 5;
            transition: var(--transition-main);
        }
        .main-logo {
            font-size: 5rem; font-weight: 900; background: linear-gradient(135deg, var(--emi-primary), var(--bonnie-primary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 40px; letter-spacing: -3px;
        }
        .dday-container { display: flex; gap: 35px; }
        .dday-item {
            background: var(--glass-bg); padding: 35px 50px; border-radius: var(--radius-main);
            box-shadow: var(--shadow-float); border: var(--border-light); text-align: center;
            cursor: pointer; transition: 0.3s;
        }
        .dday-item:hover { transform: translateY(-10px); }
        .dday-val { font-size: 3.5rem; font-weight: 900; color: var(--emi-primary); }

        .nav-dock {
            position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%);
            z-index: 1000; width: 90%; max-width: 750px;
            background: rgba(255,255,255,0.92); backdrop-filter: blur(25px);
            border-radius: var(--radius-round); padding: 12px 20px;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.4);
        }
        .nav-link { 
            color: #888; font-weight: 800; font-size: 0.9rem; cursor: pointer; padding: 10px; 
            transition: 0.3s; position: relative;
        }
        .nav-link.active { color: var(--emi-primary); transform: scale(1.1); }
        .nav-link.active::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; background: var(--emi-primary); border-radius: 50%; }

        /* ============================================================
           4. æ¨¡æ…‹åˆ†é ç³»çµ± (Page Overlay System)
           ============================================================ */
        .overlay-p {
            position: fixed; inset: 0; background: #ffffff; z-index: 500;
            transform: translateY(100%); transition: 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            overflow-y: auto; padding-bottom: 150px;
        }
        .overlay-p.active { transform: translateY(0); }
        .page-header {
            position: sticky; top: 0; background: #fff; padding: 30px 40px;
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
            border-bottom: 1px solid #f0f0f0;
        }

        /* äº¤äº’ç·¨è¼¯å™¨æ¨£å¼ */
        .editor-zone { 
            background: #f9f9f9; border: 2.5px dashed #ddd; border-radius: 20px;
            padding: 25px; margin: 20px; display: none; 
        }
        .input-ui { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid #eee; font-size: 1rem; }
        .btn-ui { width: 100%; padding: 16px; background: linear-gradient(135deg, var(--emi-primary), var(--bonnie-primary)); color: #fff; border: none; border-radius: 15px; font-weight: 800; cursor: pointer; box-shadow: 0 10px 20px rgba(243,112,33,0.2); }

        /* ============================================================
           5. æ¨¡çµ„å°ˆå±¬æ¨£å¼ (Module Styles)
           ============================================================ */
        /* ä½œå“é›†æ‹ç«‹å¾— */
        .polaroid-grid { display: flex; flex-wrap: wrap; gap: 20px; padding: 30px; justify-content: center; }
        .polaroid-card {
            background: #fff; width: calc(50% - 20px); max-width: 260px; padding: 12px 12px 40px 12px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.06); border: 1px solid #eee; position: relative;
            transform: rotate(var(--r)); transition: 0.4s;
        }
        .polaroid-card:hover { transform: rotate(0) translateY(-10px) scale(1.05); z-index: 50; }
        .polaroid-card img { width: 100%; aspect-ratio: 1; object-fit: cover; }
        .del-x { position: absolute; top: -10px; right: -10px; width: 32px; height: 32px; background: #ff4757; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(255,0,0,0.3); border: 2px solid #fff; }

        /* çè—é¤¨ç€‘å¸ƒæµ */
        .masonry-view { column-count: 2; column-gap: 15px; padding: 20px; }
        .masonry-item { break-inside: avoid; margin-bottom: 15px; border-radius: 15px; overflow: hidden; background: #fff; border: 1px solid #eee; position: relative; }
        .masonry-item img { width: 100%; display: block; }

        /* è»Œè·¡éŒ„éšæ¢¯ */
        .ladder-view { position: relative; padding: 40px 20px; }
        .ladder-view::before { content: ''; position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: #eee; transform: translateX(-50%); }
        .ladder-step { width: 45%; margin-bottom: 40px; padding: 20px; background: #fff; border-radius: 15px; box-shadow: var(--shadow-float); position: relative; }
        .ladder-step.L { margin-left: 0; text-align: right; border-right: 5px solid var(--emi-primary); }
        .ladder-step.R { margin-left: 55%; text-align: left; border-left: 5px solid var(--bonnie-primary); }

        /* 3D æ—¥è¨˜ç¿»é  */
        .diary-page { background: #fff; margin: 20px; padding: 30px; border-left: 12px solid var(--emi-primary); border-radius: 0 20px 20px 0; box-shadow: 10px 10px 30px rgba(0,0,0,0.03); transform-origin: left center; animation: pageIn 0.8s ease-out; }
        @keyframes pageIn { from { transform: perspective(1000px) rotateY(-30deg); opacity: 0; } to { transform: perspective(1000px) rotateY(0deg); opacity: 1; } }
    </style>
</head>
<body>

    <div class="ambient-glow"></div>
    
    <div class="butterfly-asset" style="top:15%; left:10%;">
        <div class="wing-l"></div><div class="wing-r"></div><div class="b-body"></div>
    </div>
    <div class="butterfly-asset" style="bottom:20%; right:15%; transform: rotate(-20deg) scale(0.8);">
        <div class="wing-l" style="background:var(--bonnie-gradient)"></div>
        <div class="wing-r" style="background:var(--bonnie-gradient)"></div>
        <div class="b-body"></div>
    </div>

    <main class="hero-view" id="view-home">
        <h1 class="main-logo">EmiBonnie</h1>
        <div class="dday-container">
            <div class="dday-item" onclick="logic_SetDDay('born')">
                <div style="font-size:0.8rem; color:#aaa; font-weight:800; letter-spacing:2px;">è´è¶èª•ç”Ÿ</div>
                <div id="out-born" class="dday-val">0</div>
            </div>
            <div class="dday-item" onclick="logic_SetDDay('meet')">
                <div style="font-size:0.8rem; color:#aaa; font-weight:800; letter-spacing:2px;">èˆ‡ä½ ç›¸é‡</div>
                <div id="out-meet" class="dday-val" style="color:var(--bonnie-primary)">0</div>
            </div>
        </div>
    </main>

    <nav class="nav-dock">
        <div class="nav-link active" onclick="ui_Navigate('home', this)">ğŸ¦‹</div>
        <div class="nav-link" onclick="ui_Navigate('page-profile', this)">åç‰Œ</div>
        <div class="nav-link" onclick="ui_Navigate('page-works', this)">ä½œå“</div>
        <div class="nav-link" onclick="ui_Navigate('page-timeline', this)">è»Œè·¡</div>
        <div class="nav-link" onclick="ui_Navigate('page-colls', this)">çè—</div>
        <div class="nav-link" onclick="ui_Navigate('page-plans', this)">è¡Œç¨‹</div>
        <div class="nav-link" onclick="ui_Navigate('page-diary', this)">æ—¥è¨˜</div>
    </nav>

    <section id="page-profile" class="overlay-p">
        <header class="page-header"><b>æˆå“¡åç‰Œç®¡å®¶</b><span onclick="ui_Navigate('home')" style="cursor:pointer; font-size:1.8rem;">âœ•</span></header>
        <div style="display:flex; justify-content:center; gap:20px; padding:30px;">
            <button class="nav-link" onclick="logic_SwitchMember('emi', this)">Emi</button>
            <button class="nav-link" onclick="logic_SwitchMember('bonnie', this)">Bonnie</button>
            <button class="nav-link" onclick="logic_SwitchMember('any', this)">Any</button>
        </div>
        <div style="text-align:center; padding:40px;">
            <div style="width:160px; height:160px; margin:0 auto 25px; border-radius:50%; border:5px solid var(--emi-primary); padding:5px; cursor:pointer;" onclick="document.getElementById('file-p').click()">
                <img id="p-img" src="https://via.placeholder.com/200" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">
            </div>
            <input type="file" id="file-p" style="display:none" onchange="logic_HandleAvatar(this)">
            <h2 id="p-name" style="font-size:2.5rem; margin-bottom:10px;">NAME</h2>
            <p id="p-bio" style="color:#666; padding:0 40px; line-height:1.8; margin-bottom:30px;">è¼‰å…¥ä¸­...</p>
            <button class="btn-ui" style="width:auto; padding:12px 40px;" onclick="ui_ToggleEditor('edit-p')">ç·¨è¼¯åç‰Œ</button>
            <div id="edit-p" class="editor-zone">
                <textarea id="p-in-bio" class="input-ui" rows="4"></textarea>
                <button class="btn-ui" onclick="logic_SaveProfile()">ä¿å­˜æ›´æ–°</button>
            </div>
        </div>
    </section>

    <section id="page-works" class="overlay-p">
        <header class="page-header"><b style="color:var(--emi-primary)">è´è¶ä½œå“é›†</b><div onclick="ui_ToggleEditor('edit-w')" style="cursor:pointer; font-size:2.5rem; color:var(--emi-primary)">ï¼‹</div></header>
        <div id="edit-w" class="editor-zone">
            <h3>ç™¼å¸ƒæ–°å›æ†¶</h3>
            <input type="text" id="w-in-t" class="input-ui" placeholder="ä½œå“æ¨™é¡Œ...">
            <select id="w-in-c" class="input-ui"><option>å½±è¦–</option><option>éŸ³æ¨‚</option><option>æ¼”å‡º</option></select>
            <input type="file" id="w-in-f" class="input-ui">
            <button class="btn-ui" onclick="logic_AddItem('works')">ç™¼å¸ƒæ‹ç«‹å¾—</button>
        </div>
        <div id="render-works" class="polaroid-grid"></div>
    </section>

    <section id="page-timeline" class="overlay-p">
        <header class="page-header"><b>æˆé•·è»Œè·¡éŒ„</b><div onclick="ui_ToggleEditor('edit-tl')" style="cursor:pointer; font-size:2.5rem;">ï¼‹</div></header>
        <div id="edit-tl" class="editor-zone">
            <input type="text" id="tl-in-t" class="input-ui" placeholder="äº‹ä»¶æ¨™é¡Œ...">
            <input type="date" id="tl-in-d" class="input-ui">
            <button class="btn-ui" onclick="logic_AddItem('timeline')">å¯«å…¥æ™‚ç©ºæ©Ÿ</button>
        </div>
        <div class="ladder-view">
            <div id="render-timeline"></div>
        </div>
    </section>

    <section id="page-colls" class="overlay-p">
        <header class="page-header"><b style="color:var(--bonnie-primary)">ç§äººçè—é¤¨</b><div onclick="ui_ToggleEditor('edit-c')" style="cursor:pointer; font-size:2.5rem; color:var(--bonnie-primary)">ï¼‹</div></header>
        <div id="edit-c" class="editor-zone" style="border-color:var(--bonnie-primary)">
            <input type="text" id="c-in-n" class="input-ui" placeholder="ç°¡å–®æè¿°...">
            <input type="file" id="c-in-f" class="input-ui">
            <button class="btn-ui" style="background:var(--bonnie-primary)" onclick="logic_AddItem('colls')">å­˜å…¥çè—</button>
        </div>
        <div id="render-colls" class="masonry-view"></div>
    </section>

    <section id="page-plans" class="overlay-p">
        <header class="page-header"><b>è´è¶è¡Œç¨‹è¡¨</b><span onclick="ui_Navigate('home')">âœ•</span></header>
        <div style="display:grid; grid-template-columns:repeat(7, 1fr); gap:2px; background:#eee; margin:20px; border-radius:15px; overflow:hidden; border:2px solid #eee;">
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(1)"><b>1</b><div id="plan-1" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(2)"><b>2</b><div id="plan-2" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(3)"><b>3</b><div id="plan-3" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(4)"><b>4</b><div id="plan-4" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(5)"><b>5</b><div id="plan-5" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(6)"><b>6</b><div id="plan-6" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(7)"><b>7</b><div id="plan-7" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(8)"><b>8</b><div id="plan-8" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(9)"><b>9</b><div id="plan-9" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            <div style="background:#fff; min-height:120px; padding:10px; cursor:pointer;" onclick="logic_EditPlan(10)"><b>10</b><div id="plan-10" style="font-size:0.7rem; color:var(--emi-primary); margin-top:5px;"></div></div>
            </div>
    </section>

    <section id="page-diary" class="overlay-p">
        <header class="page-header"><b>è´è¶éš¨ç­†æ—¥è¨˜</b><div onclick="ui_ToggleEditor('edit-dy')" style="cursor:pointer; font-size:2.5rem;">ï¼‹</div></header>
        <div id="edit-dy" class="editor-zone">
            <textarea id="dy-in-t" class="input-ui" rows="5" placeholder="æ­¤åˆ»çš„å¿ƒæƒ…..."></textarea>
            <button class="btn-ui" onclick="logic_AddItem('diary')">å¯†å°æ—¥è¨˜</button>
        </div>
        <div id="render-diary" style="padding:20px;"></div>
    </section>

    <script>
        /**
         * 1. æ•¸æ“šåº«åˆå§‹åŒ–
         */
        const DB_KEY = "EB_ULTIMATE_VAULT_FINAL";
        let EB_DB = JSON.parse(localStorage.getItem(DB_KEY)) || {
            meta: { born: "2024-01-01", meet: "2024-05-20" },
            profiles: {
                emi: { bio: "æ´»åŠ›æ©˜è‰²è´è¶ï¼Œç”¨ç¬‘å®¹æ„ŸæŸ“ä¸–ç•Œã€‚", avatar: "" },
                bonnie: { bio: "ç¥ç¥•ç´«è‰²è´è¶ï¼Œæ­Œè²ç©¿æ¢­éŠ€æ²³ã€‚", avatar: "" },
                any: { bio: "æº«æŸ”ç²‰è‰²è´è¶ï¼Œæœ€å®‰å¿ƒçš„ä¾é ã€‚", avatar: "" }
            },
            vault: { works: [], timeline: [], colls: [], diary: [], plans: {} }
        };

        let currentMember = 'emi';

        // è³‡æ–™åŒæ­¥èˆ‡åˆ·æ–°
        const sys_Sync = () => {
            localStorage.setItem(DB_KEY, JSON.stringify(EB_DB));
            logic_UpdateDDay();
        };

        /**
         * 2. å°è¦½èˆ‡ UI è¼”åŠ©é‚è¼¯
         */
        function ui_Navigate(id, btn) {
            document.querySelectorAll('.overlay-p').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(b => b.classList.remove('active'));
            
            if(id === 'home') {
                document.getElementById('view-home').style.opacity = "1";
                document.getElementById('view-home').style.transform = "scale(1)";
                document.querySelector('.nav-link:first-child').classList.add('active');
                return;
            }

            const target = document.getElementById(id);
            target.classList.add('active');
            if(btn) btn.classList.add('active');
            document.getElementById('view-home').style.opacity = "0";
            document.getElementById('view-home').style.transform = "scale(0.95)";
            
            // è§¸ç™¼æ¸²æŸ“
            if(id === 'page-profile') logic_SwitchMember('emi');
            if(id === 'page-works') logic_RenderWorks();
            if(id === 'page-timeline') logic_RenderTimeline();
            if(id === 'page-colls') logic_RenderColls();
            if(id === 'page-diary') logic_RenderDiary();
            if(id === 'page-plans') logic_RenderPlans();
        }

        function ui_ToggleEditor(id) {
            const e = document.getElementById(id);
            e.style.display = (e.style.display === 'block' ? 'none' : 'block');
        }

        /**
         * 3. æ ¸å¿ƒåŠŸèƒ½é‚è¼¯ (CRUD)
         */
        // åç‰Œç®¡ç†
        function logic_SwitchMember(m, btn) {
            currentMember = m;
            const data = EB_DB.profiles[m];
            document.getElementById('p-name').innerText = m.toUpperCase();
            document.getElementById('p-bio').innerText = data.bio;
            document.getElementById('p-img').src = data.avatar || "https://via.placeholder.com/200";
            document.getElementById('p-in-bio').value = data.bio;
        }

        function logic_SaveProfile() {
            EB_DB.profiles[currentMember].bio = document.getElementById('p-in-bio').value;
            sys_Sync(); logic_SwitchMember(currentMember); ui_ToggleEditor('edit-p');
        }

        function logic_HandleAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => { EB_DB.profiles[currentMember].avatar = e.target.result; sys_Sync(); logic_SwitchMember(currentMember); };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // è¬ç”¨ç™¼å¸ƒç³»çµ±
        async function logic_AddItem(type) {
            const id = Date.now();
            let newItem = { id };
            
            if(type === 'works') {
                const t = document.getElementById('w-in-t').value;
                const c = document.getElementById('w-in-c').value;
                const f = document.getElementById('w-in-f').files[0];
                if(!t || !f) return;
                newItem.title = t; newItem.cat = c;
                newItem.img = await logic_ToB64(f);
                EB_DB.vault.works.push(newItem); logic_RenderWorks();
            } else if(type === 'timeline') {
                const t = document.getElementById('tl-in-t').value;
                const d = document.getElementById('tl-in-d').value;
                if(!t || !d) return;
                newItem.title = t; newItem.date = d;
                EB_DB.vault.timeline.push(newItem); logic_RenderTimeline();
            } else if(type === 'colls') {
                const n = document.getElementById('c-in-n').value;
                const f = document.getElementById('c-in-f').files[0];
                if(!f) return;
                newItem.note = n; newItem.img = await logic_ToB64(f);
                EB_DB.vault.colls.push(newItem); logic_RenderColls();
            } else if(type === 'diary') {
                const t = document.getElementById('dy-in-t').value;
                if(!t) return;
                newItem.text = t; newItem.date = new Date().toLocaleDateString();
                EB_DB.vault.diary.push(newItem); logic_RenderDiary();
            }

            sys_Sync(); ui_ToggleEditor('edit-' + (type==='works'?'w':type==='timeline'?'tl':type==='colls'?'c':'dy'));
        }

        function logic_DeleteItem(type, id) {
            if(confirm("ç¢ºå®šè¦åˆªé™¤é€™æ®µè¨˜æ†¶å—ï¼Ÿ")) {
                EB_DB.vault[type] = EB_DB.vault[type].filter(i => i.id !== id);
                sys_Sync();
                if(type === 'works') logic_RenderWorks();
                if(type === 'timeline') logic_RenderTimeline();
                if(type === 'colls') logic_RenderColls();
                if(type === 'diary') logic_RenderDiary();
            }
        }

        /**
         * 4. æ¸²æŸ“å¼•æ“
         */
        function logic_RenderWorks() {
            const container = document.getElementById('render-works');
            container.innerHTML = EB_DB.vault.works.map(item => `
                <div class="polaroid-card" style="--r: ${(Math.random()*6-3)}deg">
                    <div class="del-x" onclick="logic_DeleteItem('works', ${item.id})">Ã—</div>
                    <img src="${item.img}">
                    <div style="text-align:center; padding-top:10px;"><small style="color:var(--emi-primary)">${item.cat}</small><br><b>${item.title}</b></div>
                </div>
            `).join('');
        }

        function logic_RenderTimeline() {
            const container = document.getElementById('render-timeline');
            const sorted = [...EB_DB.vault.timeline].sort((a,b) => new Date(b.date)-new Date(a.date));
            container.innerHTML = sorted.map((item, idx) => `
                <div class="ladder-step ${idx%2===0?'L':'R'}">
                    <div class="del-x" style="width:20px; height:20px; font-size:12px;" onclick="logic_DeleteItem('timeline', ${item.id})">Ã—</div>
                    <small style="color:#aaa">${item.date}</small>
                    <div style="font-weight:700">${item.title}</div>
                </div>
            `).join('');
        }

        function logic_RenderColls() {
            const container = document.getElementById('render-colls');
            container.innerHTML = EB_DB.vault.colls.map(item => `
                <div class="masonry-item">
                    <div class="del-x" style="width:25px; height:25px;" onclick="logic_DeleteItem('colls', ${item.id})">Ã—</div>
                    <img src="${item.img}">
                    <div style="padding:10px; font-size:0.8rem;">${item.note}</div>
                </div>
            `).reverse().join('');
        }

        function logic_RenderDiary() {
            const container = document.getElementById('render-diary');
            container.innerHTML = EB_DB.vault.diary.map(item => `
                <div class="diary-page">
                    <div class="del-x" onclick="logic_DeleteItem('diary', ${item.id})">Ã—</div>
                    <small style="color:#aaa">${item.date}</small>
                    <p style="margin-top:10px; line-height:1.7;">${item.text}</p>
                </div>
            `).reverse().join('');
        }

        function logic_RenderPlans() {
            for(let i=1; i<=10; i++) {
                document.getElementById('plan-'+i).innerText = EB_DB.vault.plans[i] || "";
            }
        }

        function logic_EditPlan(day) {
            const note = prompt("è¼¸å…¥ç¬¬ "+day+" æ—¥çš„è¡Œç¨‹ç´€éŒ„ï¼š", EB_DB.vault.plans[day] || "");
            if(note !== null) { EB_DB.vault.plans[day] = note; sys_Sync(); logic_RenderPlans(); }
        }

        // å·¥å…·å‡½æ•¸
        function logic_ToB64(file) { return new Promise(res => { const r = new FileReader(); r.onload = e => res(e.target.result); r.readAsDataURL(file); }); }
        function logic_UpdateDDay() {
            const c = d => Math.floor((new Date() - new Date(d))/86400000);
            document.getElementById('out-born').innerText = c(EB_DB.meta.born);
            document.getElementById('out-meet').innerText = c(EB_DB.meta.meet);
        }
        function logic_SetDDay(k) { const v = prompt("è¼¸å…¥æ—¥æœŸ (YYYY-MM-DD)ï¼š", EB_DB.meta[k]); if(v) { EB_DB.meta[k] = v; sys_Sync(); } }

        window.onload = () => { logic_UpdateDDay(); console.log("Final System Loaded."); };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EmiBonnie Memories Eternal</title>
    <style>
        :root {
            --emi: #f37021; /* æ©˜è‰² */
            --bonnie: #662d91; /* ç´«è‰² */
            --any: #ff85a2; /* æ›´æ–°ç‚ºç²‰è‰² */
            --eb: linear-gradient(135deg, #f37021, #662d91);
            --eba: linear-gradient(135deg, #f37021, #662d91, #ff85a2);
            --grad: linear-gradient(135deg, #f37021, #662d91);
            --glass: rgba(255, 255, 255, 0.92);
        }

        /* åŸºç¤æ¨£å¼ä¿æŒä¸è®Š */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #fff; font-family: -apple-system, "PingFang TC", sans-serif; }
        
        .bg-overlay { position: fixed; inset: 0; z-index: 0; background: #fff; }
        .butterfly-bg { position: absolute; font-size: 18px; opacity: 0.12; pointer-events: none; }

        /* é¦–é è¨­è¨ˆ */
        .home-hero { position: fixed; top: 22%; width: 100%; text-align: center; z-index: 1; }
        .main-title { font-size: 3.5rem; font-weight: 900; background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 30px; }
        .dday-box { display: inline-flex; gap: 15px; }
        .dday-item {
            background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); padding: 15px 20px;
            border-radius: 20px 50px 20px 50px; border: 2px solid transparent;
            background-image: linear-gradient(white, white), var(--grad);
            background-origin: border-box; background-clip: padding-box, border-box;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        /* æ—¥æ›†æ¨™ç±¤æ›´æ–° */
        .cal-ctrl { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 15px; background: #fff; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #f0f0f0; }
        .cal-select { border: 1px solid #eee; padding: 6px 8px; border-radius: 10px; font-size: 0.9rem; font-weight: 700; background: #f9f9f9; color: #444; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #eee; margin: 0 10px; border-radius: 15px; overflow: hidden; border: 1px solid #eee; }
        .cal-day { background: #fff; min-height: 90px; padding: 6px; font-size: 0.75rem; position: relative; transition: 0.2s; }
        .cal-day.today { background: #fff9f5; }

        /* æ¨™ç±¤é¡è‰²æ›´æ–° */
        .ev-tag { font-size: 0.55rem; padding: 2px 4px; border-radius: 4px; color: #fff; margin-top: 2px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .tag-emi { background: var(--emi); }
        .tag-bonnie { background: var(--bonnie); }
        .tag-any { background: var(--any); } /* ç¾åœ¨æ˜¯ç²‰è‰² */
        .tag-emibonnie { background: var(--eb); }
        .tag-emibonnieany { background: var(--eba); }

        /* UI åˆ†é æ•ˆæœä¿æŒä¸€è‡´ */
        .nav-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 94%; max-width: 600px; }
        .main-nav { background: var(--glass); padding: 8px 12px; border-radius: 50px; backdrop-filter: blur(25px); box-shadow: 0 15px 40px rgba(0,0,0,0.1); display: flex; align-items: center; border: 1px solid rgba(255,255,255,0.7); }
        .nav-btn { background: transparent; border: none; font-size: 0.9rem; font-weight: 700; color: #555; padding: 12px 14px; flex-shrink: 0; }
        .nav-btn.active-tab { color: var(--emi); }
        .modal { position: fixed; inset: 0; background: #fff; z-index: 500; transform: translateY(100%); transition: 0.4s cubic-bezier(0.1, 0.9, 0.2, 1); overflow-y: auto; padding-bottom: 120px; }
        .modal.active { transform: translateY(0); }
        .header { position: sticky; top: 0; background: #fff; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; z-index: 100; border-bottom: 1px solid #f2f2f2; }

        #day-pop { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; z-index: 2000; padding: 25px; border-radius: 30px 30px 0 0; box-shadow: 0 -15px 40px rgba(0,0,0,0.15); display: none; }
        .pop-input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #eee; margin-top: 10px; background: #f9f9f9; }
        .btn-add-inline { width: 100%; margin-top: 12px; padding: 14px; border-radius: 12px; border: none; color: #fff; background: var(--grad); font-weight: 800; }
    </style>
</head>
<body>

<div class="bg-overlay" id="butterfly-layer"></div>

<div class="home-hero">
    <h1 class="main-title">EmiBonnie</h1>
    <div class="dday-box">
        <div class="dday-item">
            <div style="font-size:0.7rem; color:#999;">è´è¶èª•ç”Ÿ</div>
            <span id="d1" style="font-size:2.2rem; font-weight:900; color:var(--emi);">0</span><small> Days</small>
        </div>
        <div class="dday-item">
            <div style="font-size:0.7rem; color:#999;">èˆ‡ä½ ç›¸é‡</div>
            <span id="d2" style="font-size:2.2rem; font-weight:900; color:var(--bonnie);">0</span><small> Days</small>
        </div>
    </div>
</div>

<div class="nav-container">
    <nav class="main-nav">
        <div style="padding:0 12px; font-size:1.4rem;" onclick="closeAll()">ğŸ¦‹</div>
        <button class="nav-btn" onclick="openM('m-profile', this)">åç‰Œ</button>
        <button class="nav-btn" onclick="openM('m-plans', this)">è¡Œç¨‹</button>
        <button class="nav-btn" onclick="openM('m-timeline', this)">è»Œè·¡</button>
        <button class="nav-btn" onclick="openM('m-works', this)">ä½œå“</button>
        <button class="nav-btn" onclick="openM('m-diary', this)">æ—¥è¨˜</button>
        <button class="nav-btn" onclick="openM('m-admin', this)" style="color:var(--emi)">ç®¡ç†</button>
    </nav>
</div>

<div id="m-plans" class="modal">
    <div class="header"><b style="font-size:1.2rem;">è´è¶è¡Œç¨‹æœˆæ›†</b><span onclick="closeAll()">âœ•</span></div>
    <div class="cal-ctrl">
        <select class="cal-select" id="cal-year" onchange="jumpDate()"></select>
        <select class="cal-select" id="cal-month" onchange="jumpDate()"></select>
        <div style="flex:1"></div>
        <button onclick="changeMonth(-1)" style="border:none; background:none; font-size:1.2rem;">â—€</button>
        <button onclick="changeMonth(1)" style="border:none; background:none; font-size:1.2rem;">â–¶</button>
    </div>
    <div class="cal-grid" id="cal-body"></div>
</div>

<div id="m-profile" class="modal">
    <div class="header"><b>åç‰Œä»‹ç´¹</b><span onclick="closeAll()">âœ•</span></div>
    <div style="display:flex; justify-content:center; gap:10px; padding:15px;">
        <button class="nav-btn" style="border:1.5px solid var(--emi); border-radius:15px; color:var(--emi);" onclick="renderProfile('emi')">Emi</button>
        <button class="nav-btn" style="border:1.5px solid var(--bonnie); border-radius:15px; color:var(--bonnie);" onclick="renderProfile('bonnie')">Bonnie</button>
        <button class="nav-btn" style="border:1.5px solid var(--any); border-radius:15px; color:var(--any);" onclick="renderProfile('any')">Any</button>
    </div>
    <div id="p-render"></div>
</div>

<div id="m-timeline" class="modal"><div class="header"><b>è»Œè·¡</b><span onclick="closeAll()">âœ•</span></div><div id="tl-render" style="padding:20px;"></div></div>
<div id="m-works" class="modal"><div class="header"><b>ä½œå“</b><span onclick="closeAll()">âœ•</span></div><div id="w-render" style="padding:15px;"></div></div>
<div id="m-diary" class="modal"><div class="header"><b>æ—¥è¨˜</b><span onclick="closeAll()">âœ•</span></div><div id="diary-render" style="padding:20px;"></div></div>
<div id="m-admin" class="modal"><div class="header"><b>ç®¡ç†ä¸­å¿ƒ</b><span onclick="closeAll()">âœ•</span></div><div style="padding:20px;" id="adm-render">æ­¤è™•å¯æ“´å……æ•¸æ“šç®¡ç†...</div></div>

<div id="day-pop">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <b id="pop-date" style="font-size:1.1rem;"></b>
        <span onclick="document.getElementById('day-pop').style.display='none'">âœ•</span>
    </div>
    <div id="pop-list" style="max-height:150px; overflow-y:auto; margin-bottom:15px;"></div>
    
    <div style="background:#f5f5f5; padding:15px; border-radius:15px;">
        <div style="font-size:0.8rem; margin-bottom:8px; color:#666;">æ–°å¢è¡Œç¨‹å°è±¡ï¼š</div>
        <select id="pop-who" class="cal-select" style="width:100%; margin-bottom:10px; border:1px solid #ddd;">
            <option value="emi">Emi (æ©˜)</option>
            <option value="bonnie">Bonnie (ç´«)</option>
            <option value="any">Any (ç²‰)</option>
            <option value="emibonnie">EmiBonnie (æ¼¸å±¤)</option>
            <option value="emibonnieany">EmiBonnieAny (å…¨æˆå“¡)</option>
        </select>
        <input type="text" id="pop-new-ev" class="pop-input" placeholder="è¼¸å…¥è¡Œç¨‹å…§å®¹...">
        <button class="btn-add-inline" onclick="quickAddPlan()">ç™¼å¸ƒè¡Œç¨‹</button>
    </div>
</div>

<script>
    // é‚è¼¯ä¿æŒ v6ï¼Œç¢ºä¿æ¨™ç±¤å°æ‡‰æ­£æº–ç¢º
    let db = JSON.parse(localStorage.getItem('eb_mega_v7')) || {
        profiles: { emi: { bio: "ç†±æƒ…çš„æ©˜è‰²å°è´è¶ Emi", img: "" }, bonnie: { bio: "å„ªé›…çš„ç´«è‰²å°è´è¶ Bonnie", img: "" }, any: { bio: "ç”œç¾çš„ç²‰è‰²å°è´è¶ Any", img: "" } },
        settings: { born: "2024-01-01", meet: "2024-05-20" },
        plans: [], timeline: [], works: [], diaries: []
    };

    let viewDate = new Date();
    const save = () => { localStorage.setItem('eb_mega_v7', JSON.stringify(db)); renderHome(); };

    function initButterflies() {
        const layer = document.getElementById('butterfly-layer');
        for(let i=0; i<15; i++){
            const b = document.createElement('div');
            b.className = 'butterfly-bg'; b.innerHTML = 'ğŸ¦‹';
            b.style.left = Math.random()*95+'%'; b.style.top = Math.random()*95+'%';
            layer.appendChild(b);
        }
    }

    function initCalCtrls() {
        const ySel = document.getElementById('cal-year'), mSel = document.getElementById('cal-month');
        for(let y=2024; y<=2026; y++) ySel.add(new Option(y+'å¹´', y));
        for(let m=1; m<=12; m++) mSel.add(new Option(m+'æœˆ', m-1));
    }

    function renderCal() {
        const y = viewDate.getFullYear(), m = viewDate.getMonth();
        document.getElementById('cal-year').value = y;
        document.getElementById('cal-month').value = m;
        const first = new Date(y, m, 1).getDay(), days = new Date(y, m+1, 0).getDate();
        const todayStr = new Date().toISOString().split('T')[0];

        let html = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].map(d => `<div style="text-align:center; padding:8px; font-size:0.7rem; color:#bbb;">${d}</div>`).join('');
        for(let i=0; i<first; i++) html += `<div></div>`;
        for(let d=1; d<=days; d++) {
            const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const evs = db.plans.filter(p => p.date === ds);
            const isToday = ds === todayStr ? 'today' : '';
            html += `<div class="cal-day ${isToday}" onclick="showPop('${ds}')">
                <b>${d}</b>
                ${evs.map(e => `<span class="ev-tag tag-${e.who}">${e.txt}</span>`).join('')}
            </div>`;
        }
        document.getElementById('cal-body').innerHTML = html;
    }

    function showPop(d) {
        document.getElementById('pop-date').innerText = d;
        const evs = db.plans.filter(p => p.date === d);
        const nameMap = { emi: 'Emi', bonnie: 'Bonnie', any: 'Any', emibonnie: 'EB', emibonnieany: 'EBA' };
        document.getElementById('pop-list').innerHTML = evs.map((e, i) => `
            <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:0.9rem; align-items:center;">
                <span><b class="ev-tag tag-${e.who}" style="display:inline; padding:2px 6px;">${nameMap[e.who]}</b> ${e.txt}</span>
                <button onclick="delPlan('${d}',${i})" style="border:none; color:red; background:none; font-size:0.75rem;">åˆªé™¤</button>
            </div>
        `).join('') || "<p style='color:#ccc; font-size:0.8rem;'>ä»Šæ—¥ç„¡è¡Œç¨‹</p>";
        document.getElementById('day-pop').style.display = 'block';
    }

    function quickAddPlan() {
        const d = document.getElementById('pop-date').innerText;
        const w = document.getElementById('pop-who').value;
        const t = document.getElementById('pop-new-ev').value;
        if(!t) return alert("è«‹è¼¸å…¥è¡Œç¨‹å…§å®¹");
        db.plans.push({ date: d, who: w, txt: t });
        document.getElementById('pop-new-ev').value = '';
        save(); renderCal(); showPop(d);
    }

    function delPlan(d, idx) {
        db.plans = db.plans.filter((p, i) => !(p.date === d && i === idx));
        save(); renderCal(); showPop(d);
    }

    function jumpDate() { viewDate = new Date(document.getElementById('cal-year').value, document.getElementById('cal-month').value, 1); renderCal(); }
    function changeMonth(s) { viewDate.setMonth(viewDate.getMonth()+s); renderCal(); }
    function openM(id, btn) { 
        closeAll(); document.getElementById(id).classList.add('active'); 
        if(btn) btn.classList.add('active-tab'); 
        if(id==='m-plans') renderCal();
        if(id==='m-profile') renderProfile('emi');
    }
    function closeAll() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab')); }
    
    function renderProfile(who) {
        const p = db.profiles[who];
        document.getElementById('p-render').innerHTML = `<div style="text-align:center; padding:30px;"><img src="${p.img || 'https://via.placeholder.com/150'}" style="width:120px; height:120px; border-radius:60px; object-fit:cover; border:3px solid var(--${who}); box-shadow:0 10px 20px rgba(0,0,0,0.1);"><h2 style="margin-top:15px; color:var(--${who})">${who.toUpperCase()}</h2><p style="color:#666;">${p.bio}</p></div>`;
    }

    function renderHome() {
        const calc = d => Math.floor((new Date() - new Date(d)) / 86400000);
        document.getElementById('d1').innerText = Math.max(0, calc(db.settings.born));
        document.getElementById('d2').innerText = Math.max(0, calc(db.settings.meet));
    }

    window.onload = () => { initButterflies(); initCalCtrls(); renderHome(); };
</script>
</body>
</html>













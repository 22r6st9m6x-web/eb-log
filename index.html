<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EmiBonnie Memories Eternal - Pro Max</title>
    <style>
        :root {
            --emi: #f37021; --bonnie: #662d91; --any: #ff85a2;
            --eb: linear-gradient(135deg, #f37021, #662d91);
            --eba: linear-gradient(135deg, #f37021, #662d91, #ff85a2);
            --grad: linear-gradient(135deg, #f37021, #662d91);
            --glass: rgba(255, 255, 255, 0.94);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #fff; font-family: -apple-system, "PingFang TC", "Microsoft JhengHei", sans-serif; color: #333; }
        
        /* è¦–è¦ºå“ç‰Œå±¤ */
        .bg-overlay { position: fixed; inset: 0; z-index: 0; background: radial-gradient(circle at 20% 20%, rgba(243, 112, 33, 0.05) 0%, transparent 40%), radial-gradient(circle at 80% 80%, rgba(102, 45, 145, 0.05) 0%, transparent 40%); }
        .butterfly-bg { position: absolute; font-size: 20px; opacity: 0.18; pointer-events: none; transition: 0.3s; }

        /* é¦–é å››é‚Šåœ“å¼§çœ‹æ¿ */
        .home-hero { position: fixed; top: 18%; width: 100%; text-align: center; z-index: 1; padding: 0 20px; }
        .main-title { font-size: 4rem; font-weight: 900; background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0 0 40px 0; letter-spacing: -1px; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.05)); }
        .dday-box { display: flex; justify-content: center; gap: 20px; }
        .dday-item {
            background: rgba(255,255,255,0.7); backdrop-filter: blur(15px); padding: 25px 30px;
            border-radius: 20px 60px 20px 60px; /* ç‰¹è‰²å››é‚Šåœ“å¼§ */
            border: 2px solid transparent;
            background-image: linear-gradient(white, white), var(--grad);
            background-origin: border-box; background-clip: padding-box, border-box;
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
            min-width: 140px;
        }

        /* å°èˆªæ§åˆ¶ */
        .nav-container { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 92%; max-width: 650px; }
        .main-nav { background: var(--glass); padding: 10px; border-radius: 40px; backdrop-filter: blur(30px); box-shadow: 0 20px 50px rgba(0,0,0,0.12); display: flex; align-items: center; overflow-x: auto; scrollbar-width: none; border: 1px solid rgba(255,255,255,0.8); }
        .main-nav::-webkit-scrollbar { display: none; }
        .nav-btn { background: transparent; border: none; font-size: 0.9rem; font-weight: 800; color: #666; padding: 12px 18px; flex-shrink: 0; transition: 0.3s; }
        .nav-btn.active-tab { color: var(--emi); transform: scale(1.1); }

        /* å…¨èƒ½å…§å®¹æ¨¡æ…‹æ¡† */
        .modal { position: fixed; inset: 0; background: #fff; z-index: 500; transform: translateY(100%); transition: 0.5s cubic-bezier(0.19, 1, 0.22, 1); overflow-y: auto; padding-bottom: 150px; }
        .modal.active { transform: translateY(0); }
        .header { position: sticky; top: 0; background: rgba(255,255,255,0.98); padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; z-index: 100; border-bottom: 1px solid #f0f0f0; backdrop-filter: blur(10px); }
        .m-title { font-size: 1.4rem; font-weight: 900; background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* è¡Œç¨‹èˆ‡æ¨™ç±¤ (åŒ…å« Any ç²‰è‰²) */
        .cal-ctrl { display: flex; align-items: center; justify-content: space-between; padding: 20px; background: #fbfbfb; margin: 15px; border-radius: 20px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background: #eee; margin: 0 15px; border-radius: 20px; overflow: hidden; border: 2px solid #eee; }
        .cal-day { background: #fff; min-height: 100px; padding: 10px; font-size: 0.8rem; position: relative; cursor: pointer; }
        .cal-day:active { background: #f0f0f0; }
        .ev-tag { font-size: 0.6rem; padding: 3px 6px; border-radius: 6px; color: #fff; margin-top: 3px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600; }
        .tag-emi { background: var(--emi); } .tag-bonnie { background: var(--bonnie); } .tag-any { background: var(--any); }
        .tag-emibonnie { background: var(--eb); } .tag-emibonnieany { background: var(--eba); }

        /* åˆ—è¡¨å±•ç¤ºå…§å®¹ (ä½œå“/æ”¶è—) */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .item-card { background: #fff; border-radius: 20px; overflow: hidden; border: 1px solid #eee; box-shadow: 0 8px 20px rgba(0,0,0,0.04); transition: 0.3s; }
        .item-card:active { transform: scale(0.96); }
        .item-card img { width: 100%; height: 160px; object-fit: cover; background: #f5f5f5; }
        .item-info { padding: 15px; }
        .item-cat { font-size: 0.7rem; font-weight: 800; color: var(--emi); text-transform: uppercase; margin-bottom: 5px; display: block; }
        .item-n { font-size: 1rem; font-weight: 800; color: #222; }

        /* ç®¡ç†é¢æ¿ */
        .adm-card { background: #f9f9f9; padding: 25px; border-radius: 25px; margin: 15px; border: 1px solid #eee; }
        .btn-action { background: var(--grad); color: #fff; border: none; padding: 15px; width: 100%; border-radius: 15px; font-weight: 800; font-size: 1rem; margin-top: 10px; box-shadow: 0 10px 20px rgba(243, 112, 33, 0.2); }
        input, select, textarea { width: 100%; padding: 14px; margin: 8px 0; border-radius: 12px; border: 1px solid #ddd; font-size: 1rem; background: #fff; }

        /* å½ˆçª—ç´°ç¯€ */
        #day-pop { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; z-index: 2000; padding: 30px; border-radius: 35px 35px 0 0; box-shadow: 0 -20px 60px rgba(0,0,0,0.15); display: none; }
        .pop-list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f8f8; border-radius: 12px; margin-bottom: 8px; }
    </style>
</head>
<body>

<div class="bg-overlay" id="butterfly-layer"></div>

<div class="home-hero">
    <h1 class="main-title">EmiBonnie</h1>
    <div class="dday-box">
        <div class="dday-item">
            <div style="font-size:0.8rem; color:#888; margin-bottom:5px; font-weight:700;">è´è¶èª•ç”Ÿ</div>
            <span id="d1" style="font-size:2.8rem; font-weight:900; color:var(--emi);">0</span><small> Days</small>
        </div>
        <div class="dday-item">
            <div style="font-size:0.8rem; color:#888; margin-bottom:5px; font-weight:700;">èˆ‡ä½ ç›¸é‡</div>
            <span id="d2" style="font-size:2.8rem; font-weight:900; color:var(--bonnie);">0</span><small> Days</small>
        </div>
    </div>
</div>

<div class="nav-container">
    <nav class="main-nav">
        <div style="padding:0 20px; font-size:1.6rem; cursor:pointer;" onclick="closeAll()">ğŸ¦‹</div>
        <button class="nav-btn" onclick="openM('m-profile', this)">åç‰Œä»‹ç´¹</button>
        <button class="nav-btn" onclick="openM('m-plans', this)">è¡Œç¨‹å®‰æ’</button>
        <button class="nav-btn" onclick="openM('m-works', this)">å®˜æ–¹ä½œå“</button>
        <button class="nav-btn" onclick="openM('m-timeline', this)">æˆé•·è»Œè·¡</button>
        <button class="nav-btn" onclick="openM('m-coll', this)">çè—åœ–åº«</button>
        <button class="nav-btn" onclick="openM('m-diary', this)">ç§å¯†æ—¥è¨˜</button>
        <button class="nav-btn" onclick="openM('m-admin', this)" style="color:var(--emi)">ç®¡ç†å¾Œå°</button>
    </nav>
</div>

<div id="m-profile" class="modal">
    <div class="header"><span class="m-title">æˆå“¡åç‰Œ</span><span onclick="closeAll()">âœ•</span></div>
    <div style="display:flex; justify-content:center; gap:15px; padding:20px;">
        <button class="nav-btn" style="border:2px solid var(--emi); border-radius:20px;" onclick="renderProfile('emi')">Emi</button>
        <button class="nav-btn" style="border:2px solid var(--bonnie); border-radius:20px;" onclick="renderProfile('bonnie')">Bonnie</button>
        <button class="nav-btn" style="border:2px solid var(--any); border-radius:20px; color:var(--any);" onclick="renderProfile('any')">Any</button>
    </div>
    <div id="p-render"></div>
</div>

<div id="m-plans" class="modal">
    <div class="header"><span class="m-title">è¡Œç¨‹æœˆæ›†</span><span onclick="closeAll()">âœ•</span></div>
    <div class="cal-ctrl">
        <select class="cal-select" id="cal-year" onchange="jumpDate()" style="width:100px; margin:0;"></select>
        <select class="cal-select" id="cal-month" onchange="jumpDate()" style="width:100px; margin:0;"></select>
        <div style="display:flex; gap:10px;">
            <button class="nav-btn" onclick="changeMonth(-1)">ä¸Šæœˆ</button>
            <button class="nav-btn" onclick="changeMonth(1)">ä¸‹æœˆ</button>
        </div>
    </div>
    <div class="cal-grid" id="cal-body"></div>
</div>

<div id="m-works" class="modal">
    <div class="header"><span class="m-title">å®˜æ–¹ä½œå“é›†</span><span onclick="closeAll()">âœ•</span></div>
    <div class="filter-bar" style="display:flex; gap:10px; padding:10px 20px; overflow-x:auto;">
        <button class="filter-tab active" onclick="filterWorks('all', this)">å…¨éƒ¨ä½œå“</button>
        <button class="filter-tab" onclick="filterWorks('movie', this)">å½±è¦–éŒ„åƒ</button>
        <button class="filter-tab" onclick="filterWorks('music', this)">éŸ³æ¨‚å–®æ›²</button>
        <button class="filter-tab" onclick="filterWorks('show', this)">ç¾å ´æ¼”å‡º</button>
    </div>
    <div class="grid-2" id="w-render"></div>
</div>

<div id="m-timeline" class="modal">
    <div class="header"><span class="m-title">æˆé•·è»Œè·¡</span><span onclick="closeAll()">âœ•</span></div>
    <div id="tl-render" style="padding:25px;"></div>
</div>

<div id="m-coll" class="modal">
    <div class="header"><span class="m-title">çè—é¤¨</span><span onclick="closeAll()">âœ•</span></div>
    <div class="grid-2" id="coll-render"></div>
</div>

<div id="m-diary" class="modal">
    <div class="header"><span class="m-title">è´è¶ç§èªæ—¥è¨˜</span><span onclick="closeAll()">âœ•</span></div>
    <div id="diary-render" style="padding:25px;"></div>
</div>

<div id="m-admin" class="modal">
    <div class="header"><span class="m-title">ç®¡ç†ä¸­å¿ƒ</span><span onclick="closeAll()">âœ•</span></div>
    <div class="adm-card">
        <h3>âœ¨ æ–°å¢å…§å®¹</h3>
        å…§å®¹åˆ†é¡ï¼š<select id="adm-type">
            <option value="tl">æˆé•·è»Œè·¡ (Timeline)</option>
            <option value="work_movie">ä½œå“ - å½±è¦–éŒ„åƒ</option>
            <option value="work_music">ä½œå“ - éŸ³æ¨‚å–®æ›²</option>
            <option value="work_show">ä½œå“ - ç¾å ´æ¼”å‡º</option>
            <option value="coll">çè—é¤¨ (Collection)</option>
            <option value="diary">ç§å¯†æ—¥è¨˜ (Diary)</option>
        </select>
        æ¨™é¡Œåç¨±ï¼š<input type="text" id="adm-name" placeholder="è«‹è¼¸å…¥æ¨™é¡Œ...">
        å…§å®¹è©³è¿°ï¼š<textarea id="adm-txt" rows="3" placeholder="è«‹æè¿°ç²¾å½©å…§å®¹..."></textarea>
        åœ–ç‰‡ä¸Šå‚³ï¼š<input type="file" id="adm-file">
        <button class="btn-action" onclick="handleNew()">ç¢ºèªç™¼å¸ƒ</button>
    </div>
    <div class="adm-card">
        <h3>ğŸ‘¤ æˆå“¡/æ—¥æœŸè¨­å®š</h3>
        æˆå“¡é ­åƒï¼š<select id="adm-p-who"><option value="emi">Emi</option><option value="bonnie">Bonnie</option><option value="any">Any</option></select>
        <input type="file" id="adm-p-file">
        æˆå“¡ç°¡ä»‹ï¼š<textarea id="adm-p-bio" placeholder="æ›´æ–°å€‹äººç°¡ä»‹..."></textarea>
        èª•ç”Ÿæ—¥æœŸï¼š<input type="date" id="adm-born">
        ç›¸é‡æ—¥æœŸï¼š<input type="date" id="adm-meet">
        <button class="btn-action" style="background:#444;" onclick="updateSystem()">æ›´æ–°ç³»çµ±è¨­å®š</button>
    </div>
    <div class="adm-card" style="margin-bottom:100px;">
        <h3>ğŸ—‘ï¸ å…§å®¹æ¸…ç†æ¸…å–®</h3>
        <div id="adm-list-render"></div>
    </div>
</div>

<div id="day-pop">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 id="pop-date" style="margin:0; font-size:1.5rem; color:var(--bonnie);"></h2>
        <span onclick="document.getElementById('day-pop').style.display='none'" style="font-size:1.5rem;">âœ•</span>
    </div>
    <div id="pop-list" style="max-height:180px; overflow-y:auto; margin-bottom:20px;"></div>
    <div style="background:#f9f9f9; padding:20px; border-radius:20px;">
        <div style="font-size:0.8rem; color:#888; margin-bottom:10px;">å¿«é€Ÿæ–°å¢è¡Œç¨‹ï¼š</div>
        <select id="pop-who" class="cal-select" style="width:100%; margin-bottom:10px;">
            <option value="emi">Emi (æ©˜)</option>
            <option value="bonnie">Bonnie (ç´«)</option>
            <option value="any">Any (ç²‰)</option>
            <option value="emibonnie">EmiBonnie (é›™äºº)</option>
            <option value="emibonnieany">å…¨é«” (ä¸‰äºº)</option>
        </select>
        <input type="text" id="pop-new-ev" placeholder="è¼¸å…¥è¡Œç¨‹å…§å®¹..." style="margin-bottom:10px;">
        <button class="btn-action" onclick="quickAddPlan()">ç™¼å¸ƒè¡Œç¨‹</button>
    </div>
</div>

<script>
    // çµ‚æ¥µè³‡æ–™åº« v9
    let db = JSON.parse(localStorage.getItem('eb_mega_v9')) || {
        profiles: { 
            emi: { bio: "Emi æ˜¯å……æ»¿æ´»åŠ›çš„æ©˜è‰²å°è´è¶ï¼Œæœ€å–œæ­¡å”±æ­Œã€‚", img: "" }, 
            bonnie: { bio: "Bonnie æ˜¯å„ªé›…ç¥ç¥•çš„ç´«è‰²å°è´è¶ï¼Œæ“…é•·èˆè¹ˆã€‚", img: "" }, 
            any: { bio: "Any æ˜¯ç”œç¾å¯äººçš„ç²‰è‰²å°è´è¶ï¼Œæ˜¯å¤§å®¶çš„é–‹å¿ƒæœã€‚", img: "" } 
        },
        settings: { born: "2024-01-01", meet: "2024-05-20" },
        timeline: [], works: [], colls: [], diaries: [], plans: []
    };

    let viewDate = new Date();
    const save = () => { localStorage.setItem('eb_mega_v9', JSON.stringify(db)); renderHome(); };
    const toBase64 = f => new Promise(r => { if(!f) r(""); else { const rd=new FileReader(); rd.onload=e=>r(e.target.result); rd.readAsDataURL(f); } });

    // ç®¡ç†ä¸­å¿ƒåŠŸèƒ½
    async function handleNew() {
        const typeRaw = document.getElementById('adm-type').value;
        const img = await toBase64(document.getElementById('adm-file').files[0]);
        const data = { id: Date.now(), n: document.getElementById('adm-name').value, t: document.getElementById('adm-txt').value, i: img, date: new Date().toLocaleDateString() };
        
        if(typeRaw.startsWith('work_')) { data.cat = typeRaw.split('_')[1]; db.works.unshift(data); }
        else if(typeRaw === 'tl') db.timeline.unshift(data);
        else if(typeRaw === 'coll') db.colls.unshift(data);
        else if(typeRaw === 'diary') db.diaries.unshift(data);
        
        save(); renderManageList(); alert("ç™¼å¸ƒå®Œæˆï¼");
    }

    async function updateSystem() {
        const who = document.getElementById('adm-p-who').value;
        const bio = document.getElementById('adm-p-bio').value;
        const born = document.getElementById('adm-born').value;
        const meet = document.getElementById('adm-meet').value;
        const img = await toBase64(document.getElementById('adm-p-file').files[0]);

        if(bio) db.profiles[who].bio = bio;
        if(img) db.profiles[who].img = img;
        if(born) db.settings.born = born;
        if(meet) db.settings.meet = meet;
        save(); alert("ç³»çµ±èˆ‡åç‰Œå·²æ›´æ–°ï¼");
    }

    function renderManageList() {
        const container = document.getElementById('adm-list-render');
        const items = [
            ...db.timeline.map(x=>({...x, l:'è»Œè·¡', ty:'timeline'})),
            ...db.works.map(x=>({...x, l:'ä½œå“', ty:'works'})),
            ...db.colls.map(x=>({...x, l:'çè—', ty:'colls'})),
            ...db.diaries.map(x=>({...x, l:'æ—¥è¨˜', ty:'diaries'}))
        ];
        container.innerHTML = items.map(i => `
            <div class="pop-list-item">
                <span><b>[${i.l}]</b> ${i.n || i.t.substring(0,10)}</span>
                <button onclick="delData('${i.ty}', ${i.id})" style="color:red; border:none; background:none; font-weight:800;">âœ•</button>
            </div>
        `).join('') || "ç›®å‰ç„¡ä»»ä½•ç™¼å¸ƒå…§å®¹ã€‚";
    }

    function delData(ty, id) { if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) { db[ty] = db[ty].filter(x => x.id !== id); save(); renderManageList(); } }

    // è¡Œç¨‹ç³»çµ±
    function renderCal() {
        const y = viewDate.getFullYear(), m = viewDate.getMonth();
        document.getElementById('cal-year').value = y; document.getElementById('cal-month').value = m;
        const first = new Date(y, m, 1).getDay(), days = new Date(y, m+1, 0).getDate();
        let h = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].map(d => `<div style="text-align:center; padding:10px; font-size:0.7rem; color:#bbb;">${d}</div>`).join('');
        for(let i=0; i<first; i++) h += `<div></div>`;
        for(let d=1; d<=days; d++) {
            const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const evs = db.plans.filter(p => p.date === ds);
            h += `<div class="cal-day" onclick="showPop('${ds}')"><b>${d}</b>${evs.map(e => `<span class="ev-tag tag-${e.who}">${e.txt}</span>`).join('')}</div>`;
        }
        document.getElementById('cal-body').innerHTML = h;
    }

    function showPop(d) {
        document.getElementById('pop-date').innerText = d;
        const evs = db.plans.filter(p => p.date === d);
        document.getElementById('pop-list').innerHTML = evs.map((e, i) => `
            <div class="pop-list-item">
                <span><span class="ev-tag tag-${e.who}" style="display:inline;">${e.who.toUpperCase()}</span> ${e.txt}</span>
                <button onclick="delPlan('${d}',${i})" style="color:red; border:none; background:none;">âœ•</button>
            </div>
        `).join('') || "<div style='color:#ccc; text-align:center;'>ä»Šå¤©æš«æ™‚æ²’æœ‰è¡Œç¨‹ï½</div>";
        document.getElementById('day-pop').style.display = 'block';
    }

    function quickAddPlan() {
        const d = document.getElementById('pop-date').innerText, w = document.getElementById('pop-who').value, t = document.getElementById('pop-new-ev').value;
        if(!t) return alert("è«‹è¼¸å…¥è¡Œç¨‹å…§å®¹");
        db.plans.push({ date: d, who: w, txt: t });
        document.getElementById('pop-new-ev').value = ''; save(); renderCal(); showPop(d);
    }

    function delPlan(d, idx) { db.plans = db.plans.filter((p, i) => !(p.date === d && i === idx)); save(); renderCal(); showPop(d); }

    // é é¢æ¸²æŸ“é‚è¼¯
    function openM(id, btn) {
        closeAll(); document.getElementById(id).classList.add('active');
        if(btn) btn.classList.add('active-tab');
        if(id === 'm-plans') renderCal();
        if(id === 'm-profile') renderProfile('emi');
        if(id === 'm-works') filterWorks('all');
        if(id === 'm-timeline') document.getElementById('tl-render').innerHTML = db.timeline.map(t => `<div style="margin-bottom:30px; border-left:4px solid var(--emi); padding-left:20px; position:relative;"><small style="color:#aaa;">${t.date}</small><br><b>${t.n}</b><p>${t.t}</p>${t.i?`<img src="${t.i}" style="width:100%; border-radius:15px; margin-top:10px;">`:''}</div>`).join('') || "ç­‰å¾…è¨˜éŒ„ç¬¬ä¸€ä»½å›æ†¶...";
        if(id === 'm-coll') document.getElementById('coll-render').innerHTML = db.colls.map(c => `<div class="item-card"><img src="${c.i}"><div class="item-info"><span class="item-n">${c.n}</span></div></div>`).join('') || "åœ–åº«æš«ç„¡å…§å®¹";
        if(id === 'm-diary') document.getElementById('diary-render').innerHTML = db.diaries.map(d => `<div style="background:#fff9f9; padding:25px; border-radius:25px; margin-bottom:20px; border:1px solid #ffebeb;"><small style="color:var(--any); font-weight:800;">${d.date}</small><h3 style="margin:10px 0;">${d.n}</h3><p style="line-height:1.6;">${d.t}</p>${d.i?`<img src="${d.i}" style="width:100%; border-radius:15px; margin-top:15px;">`:''}</div>`).join('') || "é€™è£¡å¯«ä¸‹çš„éƒ½æ˜¯æ‚„æ‚„è©±...";
        if(id === 'm-admin') {
            document.getElementById('adm-born').value = db.settings.born;
            document.getElementById('adm-meet').value = db.settings.meet;
            renderManageList();
        }
    }

    function filterWorks(cat, btn) {
        if(btn) { document.querySelectorAll('.filter-tab').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
        const list = cat === 'all' ? db.works : db.works.filter(w => w.cat === cat);
        const map = { movie: 'å½±è¦–éŒ„åƒ', music: 'éŸ³æ¨‚å–®æ›²', show: 'ç¾å ´æ¼”å‡º' };
        document.getElementById('w-render').innerHTML = list.map(w => `<div class="item-card"><img src="${w.i || 'https://via.placeholder.com/300x200'}"><div class="item-info"><span class="item-cat">${map[w.cat] || 'ä½œå“'}</span><span class="item-n">${w.n}</span><p style="font-size:0.8rem; color:#888; margin-top:8px;">${w.t}</p></div></div>`).join('') || "ä½œå“é›†å‚™å¦¥ä¸­...";
    }

    function renderProfile(who) {
        const p = db.profiles[who];
        document.getElementById('p-render').innerHTML = `
            <div style="text-align:center; padding:40px;">
                <img src="${p.img || 'https://via.placeholder.com/200'}" style="width:150px; height:150px; border-radius:75px; object-fit:cover; border:5px solid var(--${who}); box-shadow:0 15px 30px rgba(0,0,0,0.1);">
                <h1 style="color:var(--${who}); font-size:2.2rem; margin-top:20px;">${who.toUpperCase()}</h1>
                <div style="background:#fcfcfc; padding:25px; border-radius:25px; margin:20px; line-height:1.8;">${p.bio}</div>
            </div>`;
    }

    function closeAll() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab')); }
    function jumpDate() { viewDate = new Date(document.getElementById('cal-year').value, document.getElementById('cal-month').value, 1); renderCal(); }
    function changeMonth(s) { viewDate.setMonth(viewDate.getMonth()+s); renderCal(); }
    
    function renderHome() {
        const calc = d => Math.floor((new Date() - new Date(d)) / 86400000);
        document.getElementById('d1').innerText = Math.max(0, calc(db.settings.born));
        document.getElementById('d2').innerText = Math.max(0, calc(db.settings.meet));
    }

    window.onload = () => {
        const yS = document.getElementById('cal-year'), mS = document.getElementById('cal-month');
        for(let y=2024; y<=2026; y++) yS.add(new Option(y+'å¹´', y));
        for(let m=1; m<=12; m++) mS.add(new Option(m+'æœˆ', m-1));
        
        const layer = document.getElementById('butterfly-layer');
        for(let i=0; i<20; i++){
            const b = document.createElement('div'); b.className = 'butterfly-bg'; b.innerHTML = 'ğŸ¦‹';
            b.style.left = Math.random()*95+'%'; b.style.top = Math.random()*95+'%';
            b.style.fontSize = (12 + Math.random()*15) + 'px';
            layer.appendChild(b);
        }
        renderHome();
    };
</script>
</body>
</html>















<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EB Butterfly Memories</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --emi-orange: #f37021;
            --bonnie-purple: #662d91;
            --any-pink: #ff8fab;
            --pure-white: #ffffff;
        }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--pure-white); font-family: -apple-system, "PingFang TC", sans-serif; }

        /* èƒŒæ™¯èˆ‡ç‰¹æ•ˆå±¤ */
        #slideshow { position: fixed; inset: 0; z-index: 1; }
        .slide { position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0; transition: opacity 2.5s ease; }
        .slide.active { opacity: 1; }
        .white-overlay { position: fixed; inset: 0; background: rgba(255, 255, 255, 0.7); z-index: 2; pointer-events: none; }
        #butterfly-layer { position: fixed; inset: 0; z-index: 3; pointer-events: none; }
        .butterfly { position: absolute; opacity: 0; animation: butterfly-fly linear infinite; user-select: none; }
        @keyframes butterfly-fly {
            0% { transform: translate(-10%, 110%) rotate(0deg) scale(0.5); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translate(110%, -10%) rotate(360deg) scale(1.2); opacity: 0; }
        }

        /* ä¸»é ä¸­å¤®æ¨™é¡Œ */
        .hero { position: fixed; top: 45%; left: 50%; transform: translate(-50%, -50%); z-index: 5; text-align: center; width: 100%; }
        .eb-logo { font-size: 6rem; font-weight: 800; letter-spacing: 5px; margin: 0; }
        .e-char { color: var(--emi-orange); }
        .b-char { color: var(--bonnie-purple); }
        .sub-title { font-size: 0.8rem; letter-spacing: 8px; color: #aaa; margin-top: -10px; text-transform: uppercase; }
        .main-counters { display: flex; justify-content: center; align-items: center; gap: 40px; margin-top: 40px; }
        .counter-num { font-size: 2.5rem; font-weight: 900; line-height: 1; margin-bottom: 8px; color: #333; }
        .counter-label { font-size: 0.7rem; letter-spacing: 2px; color: #999; font-weight: 600; }

        /* å°èˆªæ¬„ */
        .nav-bar { position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); z-index: 100; display: flex; gap: 20px; background: rgba(255,255,255,0.9); padding: 12px 25px; border-radius: 50px; backdrop-filter: blur(10px); box-shadow: 0 5px 20px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; }
        .nav-btn { background: transparent; border: none; font-size: 0.95rem; font-weight: 600; color: #777; cursor: pointer; transition: 0.3s; }

        /* æ¨¡æ…‹è¦–çª— */
        .modal { position: fixed; inset: 0; background: #fff; z-index: 200; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow-y: auto; }
        .modal.active { transform: translateY(0); }
        .modal-header { position: sticky; top: 0; background: #fff; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f9f9f9; z-index: 10; }
        .close-btn { border: none; background: #eee; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; }

        /* è¡Œç¨‹è¡¨æ¨£å¼ */
        .calendar-nav { display: flex; align-items: center; gap: 10px; padding: 12px 20px; background: #fffaf9; border-bottom: 1px solid #f0f0f0; flex-wrap: wrap; }
        .filter-tag { padding: 5px 15px; border-radius: 20px; font-size: 0.75rem; cursor: pointer; background: #eee; color: #666; transition: 0.2s; }
        .filter-tag.active[data-type="all"] { background: #333; color: white; }
        .filter-tag.active[data-type="emi"] { background: var(--emi-orange); color: white; }
        .filter-tag.active[data-type="any"] { background: var(--any-pink); color: white; }
        .filter-tag.active[data-type="bonnie"] { background: var(--bonnie-purple); color: white; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #eee; padding: 1px; }
        .weekday { background: #fdfdfd; text-align: center; font-size: 0.8rem; color: #888; padding: 10px 0; font-weight: bold; }
        .day-cell { min-height: 110px; background: #fff; padding: 5px; position: relative; }
        .day-num { font-size: 0.75rem; color: #333; margin-bottom: 5px; font-weight: bold; }
        
        /* è¡Œç¨‹æ¨™ç±¤è‰²å½© */
        .event-tag { font-size: 0.7rem; padding: 4px 6px; border-radius: 4px; margin-bottom: 4px; line-height: 1.2; border-left: 3px solid; }
        .event-tag.emi { border-color: var(--emi-orange); background: rgba(243, 112, 33, 0.08); color: #d35400; }
        .event-tag.bonnie { border-color: var(--bonnie-purple); background: rgba(102, 45, 145, 0.08); color: #4a235a; }
        .event-tag.any { border-color: var(--any-pink); background: rgba(255, 143, 171, 0.12); color: #b3365b; }
        .event-loc { font-size: 0.6rem; opacity: 0.7; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .content { padding: 20px; max-width: 800px; margin: 0 auto; }
        .section-box { background: #fbfbfb; border-radius: 20px; padding: 20px; margin-bottom: 20px; border: 1px solid #f0f0f0; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #eee; font-size: 1rem; }
        .btn-submit { background: linear-gradient(to right, var(--emi-orange), var(--bonnie-purple)); color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="slideshow"></div>
<div class="white-overlay"></div>
<div id="butterfly-layer"></div>

<div class="hero">
    <h1 class="eb-logo"><span class="e-char">E</span><span class="b-char">B</span></h1>
    <div class="sub-title">â€” Butterfly Memories â€”</div>
    <div class="main-counters">
        <div class="counter-item"><span class="counter-num" id="d-group">0</span><span class="counter-label">è´è¶èª•ç”Ÿ</span></div>
        <div style="width: 1px; height: 30px; background: #eee;"></div>
        <div class="counter-item"><span class="counter-num" id="d-follow">0</span><span class="counter-label">èˆ‡å¦³ç›¸é‡</span></div>
    </div>
</div>

<nav class="nav-bar">
    <button class="nav-btn" onclick="toggleM('m-timeline')">å›æ†¶</button>
    <button class="nav-btn" onclick="toggleM('m-plan')">è¡Œç¨‹</button>
    <button class="nav-btn admin" onclick="toggleM('m-admin')">è¨­å®š</button>
</nav>

<div id="m-plan" class="modal">
    <div class="modal-header">
        <div style="display:flex; align-items:center; gap:15px;">
            <h3>è´è¶è¡Œç¨‹è¡¨</h3>
            <div style="font-size: 1.1rem; color: var(--emi-orange); font-weight: bold;">2026å¹´ 2æœˆ</div>
        </div>
        <button class="close-btn" onclick="toggleM('m-plan')">âœ•</button>
    </div>
    <div class="calendar-nav">
        <span style="font-size:0.75rem; color:#999;">ç¯©é¸:</span>
        <div class="filter-tag active" data-type="all" onclick="setFilter('all', this)">å…¨éƒ¨</div>
        <div class="filter-tag" data-type="emi" onclick="setFilter('emi', this)">Emi</div>
        <div class="filter-tag" data-type="any" onclick="setFilter('any', this)">Any (ç²‰ç´…)</div>
        <div class="filter-tag" data-type="bonnie" onclick="setFilter('bonnie', this)">Bonnie</div>
    </div>
    <div class="calendar-grid" id="calendar-body"></div>
</div>

<div id="m-admin" class="modal">
    <div class="modal-header"><h3>è¨­å®šä¸­å¿ƒ</h3><button class="close-btn" onclick="toggleM('m-admin')">âœ•</button></div>
    <div class="content">
        <div class="section-box">
            <label>ğŸ–¼ï¸ èƒŒæ™¯ç®¡ç†</label>
            <input type="file" id="up-bg" multiple accept="image/*">
        </div>
        <div class="section-box">
            <label>ğŸ‚ ç´€å¿µæ—¥è¨­å®š</label>
            è´è¶èª•ç”Ÿï¼š<input type="date" id="in-g" oninput="saveSys()">
            èˆ‡å¦³ç›¸é‡ï¼š<input type="date" id="in-f" oninput="saveSys()">
        </div>
        <div class="section-box">
            <label>ğŸ—“ï¸ æ–°å¢è¡Œç¨‹</label>
            æ—¥æœŸï¼š<input type="date" id="p-d">
            å°è±¡ï¼š<select id="p-who">
                <option value="emi">Emi ğŸ§¡</option>
                <option value="any">Any (ç²‰ç´…ç©å¶) ğŸŒ¸</option>
                <option value="bonnie">Bonnie ğŸ’œ</option>
            </select>
            æ¨™é¡Œï¼š<input type="text" id="p-t" placeholder="æ´»å‹•æ¨™é¡Œ">
            åœ°é»ï¼š<input type="text" id="p-loc" placeholder="æ´»å‹•åœ°é»">
            <button class="btn-submit" onclick="add('p')">å„²å­˜è¡Œç¨‹</button>
        </div>
    </div>
</div>

<script>
    let db = { p: [] }, currentFilter = 'all';

    const toggleM = (id) => {
        document.getElementById(id).classList.toggle('active');
        if(id === 'm-plan') renderCalendar();
    };

    function setFilter(type, el) {
        currentFilter = type;
        document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        renderCalendar();
    }

    function saveSys() {
        localStorage.setItem('eb_g', document.getElementById('in-g').value);
        localStorage.setItem('eb_f', document.getElementById('in-f').value);
        renderHome();
    }

    function add(type) {
        const d = document.getElementById('p-d').value;
        const w = document.getElementById('p-who').value;
        const t = document.getElementById('p-t').value;
        const l = document.getElementById('p-loc').value;
        if(!d || !t) return alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š');
        db.p.push({ date: d, who: w, title: t, loc: l });
        localStorage.setItem('eb_p', JSON.stringify(db.p));
        alert('è¡Œç¨‹å·²å„²å­˜ âœ¨');
        renderCalendar();
    }

    function renderCalendar() {
        const grid = document.getElementById('calendar-body');
        grid.innerHTML = '';
        ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(w => grid.innerHTML += `<div class="weekday">${w}</div>`);
        for(let i = 1; i <= 28; i++) {
            const dateStr = `2026-02-${i.toString().padStart(2, '0')}`;
            let events = db.p.filter(e => e.date === dateStr);
            if(currentFilter !== 'all') events = events.filter(e => e.who === currentFilter);
            let eventHtml = events.map(ev => `
                <div class="event-tag ${ev.who}">
                    <span class="event-loc">ğŸ“ ${ev.loc || 'æ´»å‹•'}</span>
                    <strong>${ev.title}</strong>
                </div>
            `).join('');
            grid.innerHTML += `<div class="day-cell"><div class="day-num">${i}</div>${eventHtml}</div>`;
        }
    }

    function renderHome() {
        const g = localStorage.getItem('eb_g'), f = localStorage.getItem('eb_f'), now = new Date();
        if(g) { document.getElementById('d-group').innerText = Math.floor((now - new Date(g))/86400000); document.getElementById('in-g').value = g; }
        if(f) { document.getElementById('d-follow').innerText = Math.floor((now - new Date(f))/86400000); document.getElementById('in-f').value = f; }
    }

    window.onload = () => {
        db.p = JSON.parse(localStorage.getItem('eb_p')) || [];
        renderHome();
        setInterval(() => {
            const layer = document.getElementById('butterfly-layer');
            const b = document.createElement('div');
            b.className = 'butterfly'; b.innerHTML = 'ğŸ¦‹';
            const duration = Math.random() * 8 + 10;
            b.style.fontSize = (Math.random() * 10 + 15) + 'px';
            b.style.left = Math.random() * 100 + 'vw';
            b.style.animationDuration = duration + 's';
            const colors = [ 'var(--emi-orange)', 'var(--bonnie-purple)', 'var(--any-pink)' ];
            b.style.color = colors[Math.floor(Math.random()*colors.length)];
            layer.appendChild(b);
            setTimeout(() => b.remove(), duration * 1000);
        }, 1200);
    };
</script>
</body>
</html>

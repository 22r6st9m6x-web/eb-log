<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EB Butterfly Memories v3</title>
    <style>
        :root { --emi: #f37021; --bonnie: #662d91; --grad: linear-gradient(135deg, #f37021, #662d91); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #fff; font-family: -apple-system, "PingFang TC", sans-serif; }

        /* ğŸ¦‹ è´è¶èƒŒæ™¯ */
        #butterfly-field { position: fixed; inset: 0; z-index: 2; pointer-events: none; }
        .butterfly { position: absolute; opacity: 0; animation: fly linear infinite; font-size: 24px; }
        @keyframes fly { 0% { transform: translate(-10%, 110%) rotate(0deg); opacity: 0; } 50% { opacity: 1; } 100% { transform: translate(110%, -10%) rotate(360deg); opacity: 0; } }

        /* ğŸ  é¦–é  */
        .hero { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); z-index: 5; text-align: center; width: 100%; }
        .eb-logo { font-size: 5.5rem; font-weight: 900; letter-spacing: 18px; margin: 0; }
        .counters { display: flex; justify-content: center; gap: 45px; margin-top: 30px; }
        .c-num { font-size: 2.8rem; font-weight: 800; color: #222; }
        .c-lab { font-size: 0.85rem; letter-spacing: 3px; color: #aaa; font-weight: bold; }

        /* ğŸ§­ å°è¦½åˆ— */
        .nav { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; gap: 8px; background: rgba(255,255,255,0.9); padding: 12px 20px; border-radius: 50px; backdrop-filter: blur(15px); box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .nav-btn { background: transparent; border: none; font-size: 0.85rem; font-weight: 700; color: #555; cursor: pointer; padding: 5px 12px; }

        /* ğŸ–¼ï¸ è¦–çª—èˆ‡çµ„ä»¶ */
        .modal { position: fixed; inset: 0; background: #fff; z-index: 100; transform: translateY(100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow-y: auto; padding-bottom: 120px; }
        .modal.active { transform: translateY(0); }
        .close-btn { position: absolute; top: 20px; right: 25px; font-size: 24px; color: #ddd; cursor: pointer; z-index: 120; }

        /* ğŸ¬ ä½œå“é›†æ¨£å¼ */
        .works-header { text-align: center; padding: 60px 20px 20px; }
        .works-title { font-size: 2.2rem; font-weight: 900; background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        .avatar-bar { display: flex; justify-content: center; gap: 12px; margin: 20px 0; }
        .avatar-circle { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #eee; padding: 2px; cursor: pointer; overflow: hidden; }
        .avatar-circle.active { border-color: var(--emi); transform: scale(1.1); }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        
        .filter-bar { display: flex; justify-content: center; gap: 15px; padding: 10px; overflow-x: auto; margin-bottom: 20px; }
        .filter-item { color: #888; font-weight: bold; padding: 8px 15px; cursor: pointer; }
        .filter-item.active { background: var(--grad); color: #fff; border-radius: 10px; }

        /* ğŸƒ å¡ç‰‡ç¶²æ ¼ */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 0 20px; }
        .g-card { background: #fff; border-radius: 12px; border: 1px solid #f0f0f0; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
        .g-img { width: 100%; height: 180px; object-fit: cover; background: #eee; }

        /* âš™ï¸ è¨­å®šä¸­å¿ƒ */
        .admin-sec { background: #fcfcfc; padding: 20px; border-radius: 20px; margin: 15px auto; max-width: 500px; border: 1px solid #eee; }
        input[type="file"] { margin: 10px 0; font-size: 0.8rem; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; }
        .save-btn { background: #333; color: #fff; border: none; padding: 14px; width: 100%; border-radius: 10px; font-weight: bold; }
        
        /* ğŸ“– æ—¥è¨˜ */
        .d-container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .year-card { margin-bottom: 10px; border: 1px solid #eee; border-radius: 15px; }
        .year-label { padding: 15px; cursor: pointer; font-weight: bold; display: flex; justify-content: space-between; background: #fafafa; }
        .t-line { display: none; padding: 15px 15px 15px 40px; border-left: 2px solid #eee; margin-left: 25px; }
        .year-card.open .t-line { display: block; }
    </style>
</head>
<body>

<div id="butterfly-field"></div>

<div class="hero">
    <h1 class="eb-logo"><span style="color:var(--emi)">E</span><span style="color:var(--bonnie)">B</span></h1>
    <div class="counters" id="stat-bar"></div>
</div>

<nav class="nav">
    <button class="nav-btn" onclick="openM('m-profile')">EmiBonnie</button>
    <button class="nav-btn" onclick="openM('m-diary')">è´è¶æ—¥è¨˜</button>
    <button class="nav-btn" onclick="openM('m-works')">ä½œå“é›†</button>
    <button class="nav-btn" onclick="openM('m-plan')">è¡Œç¨‹è¡¨</button>
    <button class="nav-btn" onclick="openM('m-admin')">è¨­å®š</button>
</nav>

<div id="m-works" class="modal">
    <span class="close-btn" onclick="closeM()">âœ•</span>
    <div class="works-header">
        <h2 class="works-title">å®˜æ–¹ä½œå“</h2>
        <div class="works-count" id="w-total">å…± 0 å€‹ä½œå“</div>
    </div>
    <div class="avatar-bar">
        <div class="avatar-circle active" onclick="filterByWho('all', this)"><img src="https://via.placeholder.com/100?text=All"></div>
        <div class="avatar-circle" onclick="filterByWho('emi', this)"><img id="av-emi" src=""></div>
        <div class="avatar-circle" onclick="filterByWho('bonnie', this)"><img id="av-bonnie" src=""></div>
        <div class="avatar-circle" onclick="filterByWho('any', this)"><img id="av-any" src=""></div>
    </div>
    <div class="filter-bar" id="w-filter">
        <div class="filter-item active" onclick="filterByCat('å…¨éƒ¨', this)">å…¨éƒ¨</div>
        <div class="filter-item" onclick="filterByCat('å½±è¦–', this)">å½±è¦–</div>
        <div class="filter-item" onclick="filterByCat('éŸ³æ¨‚', this)">éŸ³æ¨‚</div>
        <div class="filter-item" onclick="filterByCat('æ™‚å°š', this)">æ™‚å°š</div>
    </div>
    <div class="grid" id="w-render"></div>
</div>

<div id="m-admin" class="modal">
    <span class="close-btn" onclick="closeM()">âœ•</span>
    <div style="padding:40px 20px;">
        <div class="admin-sec">
            <h4>ğŸ‘‘ æ›´æ–°äººç‰©å¤§é ­è²¼ (ç›¸ç°¿ç›´å‚³)</h4>
            é¸æ“‡å°è±¡: <select id="set-p-who"><option value="emi">Emi</option><option value="bonnie">Bonnie</option><option value="any">Any</option></select>
            å¾ç›¸ç°¿é¸ç…§ç‰‡: <input type="file" id="file-p-img" accept="image/*">
            äººç‰©ç°¡ä»‹: <textarea id="set-p-info"></textarea>
            <button class="save-btn" onclick="saveProfileWithFile()">å„²å­˜æª”æ¡ˆ</button>
        </div>
        <div class="admin-sec">
            <h4>ğŸ¬ æ–°å¢ä½œå“/è¡Œç¨‹ (ç›¸ç°¿ç›´å‚³)</h4>
            é¡å‹: <select id="set-item-type"><option value="work">ä½œå“é›†</option><option value="plan">è¡Œç¨‹è¡¨</option></select>
            æ‰€å±¬: <select id="set-item-who"><option value="emi">Emi</option><option value="bonnie">Bonnie</option><option value="any">Any</option></select>
            åˆ†é¡: <input type="text" id="set-item-cat" placeholder="å½±è¦–/éŸ³æ¨‚/æ™‚å°š">
            æ¨™é¡Œ: <input type="text" id="set-item-t">
            å¾ç›¸ç°¿é¸å°é¢: <input type="file" id="file-item-u" accept="image/*">
            <button class="save-btn" onclick="saveItemWithFile()">å„²å­˜ä¸¦åŒæ­¥</button>
        </div>
        <div class="admin-sec">
            <h4>ğŸ”¢ è¨ˆæ•¸å™¨</h4>
            è´è¶èª•ç”Ÿ: <input type="number" id="set-c1">
            èˆ‡å¦³ç›¸é‡: <input type="number" id="set-c2">
            <button class="save-btn" onclick="saveHome()">å„²å­˜è¨ˆæ•¸</button>
        </div>
    </div>
</div>

<div id="m-profile" class="modal"><span class="close-btn" onclick="closeM()">âœ•</span><div id="p-render" style="padding:20px"></div></div>
<div id="m-diary" class="modal">
    <span class="close-btn" onclick="closeM()">âœ•</span>
    <div class="d-container">
        <button class="save-btn" onclick="addYear()">+ æ–°å¢å¹´ä»½</button>
        <div id="d-list" style="margin-top:20px"></div>
    </div>
</div>
<div id="m-plan" class="modal"><span class="close-btn" onclick="closeM()">âœ•</span><div class="grid" id="l-render" style="padding-top:60px"></div></div>

<script>
    let homeCfg = JSON.parse(localStorage.getItem('eb_home')) || { c1: 285, c2: 180 };
    let profiles = JSON.parse(localStorage.getItem('eb_profiles')) || { emi:{img:"",info:""}, bonnie:{img:"",info:""}, any:{img:"",info:""} };
    let globalItems = JSON.parse(localStorage.getItem('eb_items')) || [];
    let diaryData = JSON.parse(localStorage.getItem('eb_diaries')) || {};
    let currentWho = 'all', currentCat = 'å…¨éƒ¨';

    // --- åœ–ç‰‡è®€å–æ ¸å¿ƒå·¥å…· (Base64) ---
    async function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            if (!file) resolve("");
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    // --- å„²å­˜åŠŸèƒ½ ---
    async function saveProfileWithFile() {
        const who = document.getElementById('set-p-who').value;
        const file = document.getElementById('file-p-img').files[0];
        const base64 = file ? await fileToBase64(file) : profiles[who].img;
        profiles[who] = { img: base64, info: document.getElementById('set-p-info').value };
        localStorage.setItem('eb_profiles', JSON.stringify(profiles));
        alert("å€‹äººæª”æ¡ˆå·²æ›´æ–°ï¼");
    }

    async function saveItemWithFile() {
        const file = document.getElementById('file-item-u').files[0];
        const base64 = file ? await fileToBase64(file) : "";
        globalItems.push({
            type: document.getElementById('set-item-type').value,
            who: document.getElementById('set-item-who').value,
            cat: document.getElementById('set-item-cat').value,
            t: document.getElementById('set-item-t').value,
            u: base64
        });
        localStorage.setItem('eb_items', JSON.stringify(globalItems));
        alert("å·²å¾ç›¸ç°¿æ·»åŠ ä¸¦åŒæ­¥ï¼");
    }

    function saveHome() {
        homeCfg.c1 = document.getElementById('set-c1').value;
        homeCfg.c2 = document.getElementById('set-c2').value;
        localStorage.setItem('eb_home', JSON.stringify(homeCfg));
        location.reload();
    }

    // --- æ¸²æŸ“é‚è¼¯ ---
    function openM(id) {
        document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'm-works') {
            document.getElementById('av-emi').src = profiles.emi.img || 'https://via.placeholder.com/100';
            document.getElementById('av-bonnie').src = profiles.bonnie.img || 'https://via.placeholder.com/100';
            document.getElementById('av-any').src = profiles.any.img || 'https://via.placeholder.com/100';
            renderWorks();
        }
        if(id === 'm-plan') renderPlan();
        if(id === 'm-profile') renderProfileView();
        if(id === 'm-diary') renderDiary();
    }
    function closeM() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); }

    function filterByWho(who, el) {
        document.querySelectorAll('.avatar-circle').forEach(c => c.classList.remove('active'));
        el.classList.add('active'); currentWho = who; renderWorks();
    }
    function filterByCat(cat, el) {
        document.querySelectorAll('.filter-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active'); currentCat = cat; renderWorks();
    }

    function renderWorks() {
        let filtered = globalItems.filter(i => i.type === 'work');
        if(currentWho !== 'all') filtered = filtered.filter(i => i.who === currentWho);
        if(currentCat !== 'å…¨éƒ¨') filtered = filtered.filter(i => i.cat === currentCat);
        document.getElementById('w-total').innerText = `å…± ${filtered.length} å€‹ä½œå“`;
        document.getElementById('w-render').innerHTML = filtered.map(i => `<div class="g-card"><img src="${i.u}" class="g-img"><div style="padding:10px;"><small style="color:var(--emi);font-weight:bold">${i.cat}</small><div style="font-weight:bold;font-size:0.85rem">${i.t}</div></div></div>`).join('');
    }

    function renderPlan() {
        const filtered = globalItems.filter(i => i.type === 'plan');
        document.getElementById('l-render').innerHTML = filtered.map(i => `<div class="g-card"><img src="${i.u}" class="g-img"><div style="padding:10px;"><small style="color:var(--bonnie);font-weight:bold">${i.cat}</small><div style="font-weight:bold;font-size:0.85rem">${i.t}</div></div></div>`).join('');
    }

    function renderProfileView() {
        document.getElementById('p-render').innerHTML = ['emi','bonnie','any'].map(k => `
            <div style="margin-bottom:40px">
                <img src="${profiles[k].img}" style="width:100%; border-radius:20px; box-shadow:0 10px 20px rgba(0,0,0,0.1)">
                <h2 style="margin:15px 0 5px">${k.toUpperCase()}</h2>
                <p style="white-space:pre-wrap; color:#666; line-height:1.6">${profiles[k].info}</p>
            </div>`).join('');
    }

    // --- æ—¥è¨˜é‚è¼¯ ---
    function renderDiary() {
        const years = Object.keys(diaryData).sort((a,b)=>b-a);
        document.getElementById('d-list').innerHTML = years.map(y => `
            <div class="year-card">
                <div class="year-label" onclick="this.parentElement.classList.toggle('open')"><span>${y} å¹´</span><span>â–¾</span></div>
                <div class="t-line">
                    ${diaryData[y].map(d => `<div onclick="this.classList.toggle('active')"><strong>${d.d}</strong> ${d.t}<div style="padding:10px; color:#666">${d.b}</div></div>`).join('')}
                    <button class="save-btn" style="padding:5px; font-size:0.8rem" onclick="addNote('${y}')">+ æ–°å¢ç´€éŒ„</button>
                </div>
            </div>`).join('');
    }
    function addYear() { const y = prompt("å¹´ä»½:"); if(y){ diaryData[y]=[]; saveD(); } }
    function addNote(y) { 
        const d = prompt("æ—¥æœŸ (å¦‚ 02.25):"); const t = prompt("æ¨™é¡Œ:"); const b = prompt("å…§å®¹:");
        if(d&&t){ diaryData[y].push({d,t,b}); saveD(); }
    }
    function saveD() { localStorage.setItem('eb_diaries', JSON.stringify(diaryData)); renderDiary(); }

    window.onload = () => {
        document.getElementById('stat-bar').innerHTML = `<div class="item"><span class="c-num">${homeCfg.c1}</span><span class="c-lab">è´è¶èª•ç”Ÿ</span></div><div class="item"><span class="c-num">${homeCfg.c2}</span><span class="c-lab">èˆ‡å¦³ç›¸é‡</span></div>`;
        setInterval(() => {
            const b = document.createElement('div'); b.className = 'butterfly'; b.innerHTML = 'ğŸ¦‹';
            const dur = Math.random()*8+7; b.style.left = Math.random()*100+'vw'; b.style.animationDuration = dur+'s';
            b.style.color = Math.random() > 0.5 ? 'var(--emi)' : 'var(--bonnie)';
            document.getElementById('butterfly-field').appendChild(b);
            setTimeout(() => b.remove(), dur*1000);
        }, 1800);
    };
</script>
</body>
</html>


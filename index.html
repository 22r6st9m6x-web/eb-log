<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EB Butterfly Log - Console</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --eb-soft-pink: #ffb7c5;
            --eb-gradient: linear-gradient(135deg, #f37021 0%, #662d91 100%);
            --emi-orange: #f37021;
            --bonnie-purple: #662d91;
        }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: -apple-system, sans-serif; }

        /* ğŸ–¼ï¸ èƒŒæ™¯å¹»ç‡ˆç‰‡ */
        #slideshow { position: fixed; width: 100%; height: 100%; z-index: 1; }
        .slide { position: absolute; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; transition: opacity 2s ease-in-out; }
        .slide.active { opacity: 1; }
        .overlay { position: fixed; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 2; }

        /* ğŸŒ¸ ä¸»é ï¼šEB èˆ‡ é›™è¨ˆæ™‚å™¨ */
        .hero { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -60%); z-index: 3; text-align: center; width: 100%; }
        .eb-logo { font-size: 5.5rem; font-weight: 800; letter-spacing: 15px; color: var(--eb-soft-pink); margin: 0; text-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .main-counters { display: flex; justify-content: center; align-items: center; gap: 40px; margin-top: 20px; color: white; }
        .counter-num { font-size: 2.8rem; font-weight: 900; display: block; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .counter-label { font-size: 0.8rem; letter-spacing: 2px; opacity: 0.9; }

        /* ğŸ“± åº•éƒ¨å°èˆª */
        .nav-bar { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); z-index: 10; display: flex; gap: 20px; background: rgba(255,255,255,0.15); padding: 12px 25px; border-radius: 40px; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.2); }
        .nav-btn { width: 45px; height: 45px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; border: none; }

        /* ğŸªŸ å…¨å±åŠŸèƒ½å½ˆçª— (åƒ…é¡¯ç¤º) */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; transform: translateY(100%); transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1); overflow-y: auto; }
        .modal.open { transform: translateY(0); }
        .modal-header { position: sticky; top: 0; background: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f0f0; z-index: 10; }
        .content { padding: 20px; max-width: 600px; margin: 0 auto; }

        /* âš™ï¸ è¨­å®šä¸­å¿ƒå°ˆç”¨æ¨£å¼ */
        .setting-section { background: #f8f9fa; border-radius: 15px; padding: 15px; margin-bottom: 25px; }
        .setting-section h3 { font-size: 1rem; color: var(--bonnie-purple); margin-top: 0; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn-eb { background: var(--eb-gradient); color: white; border: none; padding: 14px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        
        /* å±•ç¤ºç”¨çµ„ä»¶ */
        .display-card { border-bottom: 1px solid #eee; padding: 20px 0; }
        .display-img { width: 100%; border-radius: 12px; margin: 10px 0; }
        .mood-tag { background: #fff0f3; color: #662d91; padding: 10px; border-radius: 10px; font-style: italic; font-size: 0.9rem; margin-top: 8px; }
    </style>
</head>
<body>

<div id="slideshow"><div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1494972308255-023c550c8188?q=80&w=2070')"></div></div>
<div class="overlay"></div>

<div class="hero">
    <h1 class="eb-logo">EB</h1>
    <div class="main-counters">
        <div class="counter-item"><span class="counter-num" id="d-group" style="color: var(--emi-orange);">0</span><span class="counter-label">è´è¶èª•ç”Ÿ</span></div>
        <div style="width: 1px; height: 30px; background: rgba(255,255,255,0.3);"></div>
        <div class="counter-item"><span class="counter-num" id="d-follow" style="color: var(--eb-soft-pink);">0</span><span class="counter-label">èˆ‡å¦³ç›¸é‡</span></div>
    </div>
</div>

<div class="nav-bar">
    <button class="nav-btn" onclick="openModal('m-timeline')">ğŸï¸</button>
    <button class="nav-btn" onclick="openModal('m-plan')">ğŸ—“ï¸</button>
    <button class="nav-btn" onclick="openModal('m-radar')">ğŸ“Š</button>
    <button class="nav-btn" onclick="openModal('m-admin')" style="background: var(--eb-soft-pink); color: white;">âš™ï¸</button>
</div>

<div id="m-timeline" class="modal">
    <div class="modal-header"><h2>ğŸï¸ å›æ†¶æ™‚å…‰æ©Ÿ</h2><button class="nav-btn" onclick="closeModal('m-timeline')">âœ•</button></div>
    <div class="content" id="display-timeline"></div>
</div>

<div id="m-plan" class="modal">
    <div class="modal-header"><h2>ğŸ—“ï¸ è´è¶è¡Œç¨‹è¡¨</h2><button class="nav-btn" onclick="closeModal('m-plan')">âœ•</button></div>
    <div class="content" id="display-plans"></div>
</div>

<div id="m-radar" class="modal">
    <div class="modal-header"><h2>ğŸ“Š é­…åŠ›è§€æ¸¬</h2><button class="nav-btn" onclick="closeModal('m-radar')">âœ•</button></div>
    <div class="content">
        <select id="radarTarget" onchange="initRadar()"><option value="emi">EMI ğŸŠ</option><option value="bonnie">BONNIE ğŸ’œ</option></select>
        <canvas id="radarChart"></canvas>
    </div>
</div>

<div id="m-admin" class="modal">
    <div class="modal-header"><h2>âš™ï¸ ç³»çµ±æ§åˆ¶å°</h2><button class="nav-btn" onclick="closeModal('m-admin')">âœ•</button></div>
    <div class="content">
        
        <div class="setting-section">
            <h3>ğŸ“¸ èƒŒæ™¯å¹»ç‡ˆç‰‡</h3>
            <input type="file" id="bgUploader" multiple accept="image/*">
        </div>

        <div class="setting-section">
            <h3>ğŸ‚ ç´€å¿µæ—¥è¨­å®š</h3>
            <label>è´è¶èª•ç”Ÿ</label><input type="date" id="s-group" oninput="saveSystem()">
            <label>èˆ‡å¦³ç›¸é‡</label><input type="date" id="s-follow" oninput="saveSystem()">
        </div>

        <div class="setting-section">
            <h3>ğŸï¸ æ·»åŠ æ–°å›æ†¶</h3>
            <input type="date" id="tlDate"><input type="text" id="tlTitle" placeholder="æ¨™é¡Œ">
            <textarea id="tlDesc" rows="3" placeholder="å…·é«”æ•…äº‹..."></textarea>
            <textarea id="tlMood" rows="2" placeholder="å¥½çš„å¿ƒæƒ…ç´€éŒ„..."></textarea>
            <input type="file" id="tlImg" accept="image/*">
            <button class="btn-eb" onclick="addTimeline()">å­˜å…¥æ™‚é–“è»¸</button>
        </div>

        <div class="setting-section">
            <h3>ğŸ—“ï¸ æ·»åŠ æ–°è¡Œç¨‹</h3>
            <input type="date" id="pDate"><input type="text" id="pTitle" placeholder="æ´»å‹•åç¨±">
            <input type="file" id="pImg" accept="image/*">
            <button class="btn-eb" onclick="addPlan()">å„²å­˜è¡Œç¨‹</button>
        </div>

        <button class="btn-eb" style="background: #ff6b6b;" onclick="clearAll()">âš ï¸ æ¸…ç©ºæ‰€æœ‰æ•¸æ“š</button>
    </div>
</div>

<script>
    let timelineData = [], plans = [], slides = [], myChart;

    // --- åŸºç¤ç³»çµ± ---
    function openModal(id) { 
        document.getElementById(id).classList.add('open'); 
        if(id === 'm-radar') initRadar();
    }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }

    async function getBase64(file) {
        return new Promise(res => {
            if(!file) return res(null);
            const r = new FileReader(); r.readAsDataURL(file);
            r.onload = () => res(r.result);
        });
    }

    // --- èƒŒæ™¯èˆ‡æ—¥æœŸ ---
    document.getElementById('bgUploader').onchange = async function(e) {
        slides = [];
        for(let f of e.target.files) { slides.push(await getBase64(f)); }
        localStorage.setItem('eb_slides', JSON.stringify(slides));
        location.reload(); 
    };

    function saveSystem() {
        localStorage.setItem('eb_g', document.getElementById('s-group').value);
        localStorage.setItem('eb_f', document.getElementById('s-follow').value);
        updateDays();
    }

    function updateDays() {
        const g = localStorage.getItem('eb_g'), f = localStorage.getItem('eb_f'), now = new Date();
        if(g) { document.getElementById('d-group').innerText = Math.floor((now - new Date(g))/86400000); document.getElementById('s-group').value = g; }
        if(f) { document.getElementById('d-follow').innerText = Math.floor((now - new Date(f))/86400000); document.getElementById('s-follow').value = f; }
    }

    // --- æ•¸æ“šæ·»åŠ  ---
    async function addTimeline() {
        const img = await getBase64(document.getElementById('tlImg').files[0]);
        const entry = {
            date: document.getElementById('tlDate').value,
            title: document.getElementById('tlTitle').value,
            desc: document.getElementById('tlDesc').value,
            mood: document.getElementById('tlMood').value,
            img: img
        };
        timelineData.unshift(entry);
        localStorage.setItem('eb_tl', JSON.stringify(timelineData));
        alert('å›æ†¶å·²å„²å­˜ï¼');
        renderDisplay();
    }

    async function addPlan() {
        const img = await getBase64(document.getElementById('pImg').files[0]);
        plans.push({
            date: document.getElementById('pDate').value,
            title: document.getElementById('pTitle').value,
            img: img
        });
        plans.sort((a,b) => a.date.localeCompare(b.date));
        localStorage.setItem('eb_plans', JSON.stringify(plans));
        alert('è¡Œç¨‹å·²å„²å­˜ï¼');
        renderDisplay();
    }

    // --- å±•ç¤ºæ¸²æŸ“ ---
    function renderDisplay() {
        const tlBox = document.getElementById('display-timeline');
        tlBox.innerHTML = timelineData.map((item, i) => `
            <div class="display-card">
                <small style="color:var(--eb-soft-pink); font-weight:bold;">${item.date}</small>
                <h3 style="margin:5px 0;">${item.title}</h3>
                ${item.img ? `<img src="${item.img}" class="display-img">` : ''}
                <p style="color:#666; font-size:0.95rem;">${item.desc}</p>
                ${item.mood ? `<div class="mood-tag">ğŸ’­ ${item.mood}</div>` : ''}
                <button onclick="deleteItem('tl', ${i})" style="color:#ccc; border:none; background:none; font-size:0.7rem;">åˆªé™¤</button>
            </div>
        `).join('');

        const pBox = document.getElementById('display-plans');
        pBox.innerHTML = plans.map((p, i) => `
            <div class="display-card">
                <div style="color:var(--emi-orange); font-weight:bold;">${p.date}</div>
                <div style="font-weight:bold; margin:5px 0;">${p.title}</div>
                ${p.img ? `<img src="${p.img}" class="display-img" style="max-height:150px; object-fit:cover;">` : ''}
                <button onclick="deleteItem('p', ${i})" style="color:#ccc; border:none; background:none; font-size:0.7rem;">åˆªé™¤</button>
            </div>
        `).join('');
    }

    function deleteItem(type, i) {
        if(!confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) return;
        if(type==='tl') { timelineData.splice(i,1); localStorage.setItem('eb_tl', JSON.stringify(timelineData)); }
        else { plans.splice(i,1); localStorage.setItem('eb_plans', JSON.stringify(plans)); }
        renderDisplay();
    }

    function clearAll() { if(confirm('âš ï¸ é€™å°‡æ¸…ç©ºæ‰€æœ‰æ•¸æ“šï¼Œç¢ºå®šå—ï¼Ÿ')) { localStorage.clear(); location.reload(); } }

    function initRadar() {
        if(myChart) myChart.destroy();
        const target = document.getElementById('radarTarget').value;
        const ctx = document.getElementById('radarChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['å¯æ„›', 'å¸¥æ°£', 'æ­Œè²', 'ç¶œè—', 'å¯µç²‰'],
                datasets: [{ data: [90, 80, 85, 88, 95], borderColor: target==='emi'?'#f37021':'#662d91', backgroundColor: 'rgba(255,183,197,0.2)' }]
            }
        });
    }

    window.onload = () => {
        timelineData = JSON.parse(localStorage.getItem('eb_tl')) || [];
        plans = JSON.parse(localStorage.getItem('eb_plans')) || [];
        const savedSlides = JSON.parse(localStorage.getItem('eb_slides')) || [];
        if(savedSlides.length > 0) {
            document.getElementById('slideshow').innerHTML = savedSlides.map((s, i) => `<div class="slide ${i===0?'active':''}" style="background-image: url('${s}')"></div>`).join('');
            let idx = 0; setInterval(() => {
                const s = document.querySelectorAll('.slide'); if(s.length<2) return;
                s[idx].classList.remove('active'); idx = (idx+1)%s.length; s[idx].classList.add('active');
            }, 5000);
        }
        updateDays(); renderDisplay();
        document.getElementById('tlDate').valueAsDate = new Date();
        document.getElementById('pDate').valueAsDate = new Date();
    };
</script>
</body>
</html>

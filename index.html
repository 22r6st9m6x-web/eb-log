<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EB | Butterfly Log</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --pink: #ffb7c5;
            --orange: #f37021;
            --purple: #662d91;
            --glass: rgba(255, 255, 255, 0.8);
        }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #fff; font-family: -apple-system, "PingFang TC", sans-serif; }

        /* ğŸ–¼ï¸ èƒŒæ™¯å¹»ç‡ˆç‰‡èˆ‡ç‰¹æ•ˆå±¤ */
        #slideshow { position: fixed; inset: 0; z-index: 1; }
        .slide { position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0; transition: opacity 2.5s ease; }
        .slide.active { opacity: 1; }
        .vignette { position: fixed; inset: 0; background: radial-gradient(circle, transparent 40%, rgba(255,255,255,0.4) 100%); z-index: 2; pointer-events: none; }

        #butterfly-layer { position: fixed; inset: 0; z-index: 3; pointer-events: none; }
        .butterfly { position: absolute; opacity: 0; animation: butterfly-fly 15s linear infinite; font-size: 20px; }
        @keyframes butterfly-fly {
            0% { transform: translate(-10%, 100%) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translate(110%, -10%) rotate(360deg); opacity: 0; }
        }

        /* ğŸŒ¸ ä¸»é ï¼šEB èˆ‡ ç´€å¿µæ—¥ */
        .hero { position: fixed; top: 45%; left: 50%; transform: translate(-50%, -50%); z-index: 5; text-align: center; width: 100%; pointer-events: none; }
        .eb-logo { 
            font-size: 6rem; font-weight: 800; letter-spacing: 15px; color: var(--pink); margin: 0;
            filter: drop-shadow(0 4px 10px rgba(255,183,197,0.5));
            animation: breathe 4s ease-in-out infinite;
        }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }

        .main-counters { display: flex; justify-content: center; align-items: center; gap: 40px; margin-top: 30px; }
        .counter-item { display: flex; flex-direction: column; align-items: center; }
        .counter-num { font-size: 2.8rem; font-weight: 900; line-height: 1; margin-bottom: 8px; }
        .counter-label { font-size: 0.75rem; letter-spacing: 3px; color: #666; font-weight: 600; }

        /* ğŸ“± åº•éƒ¨å„ªåŒ–å°èˆª */
        .nav-bar { 
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); 
            z-index: 100; display: flex; gap: 10px; background: var(--glass); 
            padding: 8px; border-radius: 40px; backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        .nav-btn { 
            background: transparent; border: none; padding: 12px 22px; font-size: 0.95rem; 
            font-weight: 600; color: #555; cursor: pointer; border-radius: 30px; transition: all 0.3s;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.5); }
        .nav-btn.admin { background: var(--pink); color: white; box-shadow: 0 4px 12px rgba(255,183,197,0.4); }

        /* ğŸªŸ æ¨¡æ…‹çª—å£æ¸²æŸ“å„ªåŒ– */
        .modal { position: fixed; inset: 0; background: #fff; z-index: 200; transform: translateY(100%); transition: transform 0.5s cubic-bezier(0.32, 1, 0.23, 1); overflow-y: auto; }
        .modal.active { transform: translateY(0); }
        .modal-header { position: sticky; top: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); padding: 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; border-bottom: 1px solid #f0f0f0; }
        .close-btn { width: 40px; height: 40px; border-radius: 50%; border: none; background: #f5f5f5; font-size: 1.2rem; cursor: pointer; color: #999; }
        .content { padding: 20px; max-width: 600px; margin: 0 auto; }

        /* å…§è¦–çª—çµ„ä»¶ */
        .section-box { background: #f9f9fb; border-radius: 24px; padding: 20px; margin-bottom: 25px; border: 1px solid #f0f0f5; }
        input, textarea, select { width: 100%; padding: 14px; margin: 10px 0; border-radius: 14px; border: 1px solid #eee; font-size: 16px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--pink); }
        .btn-submit { background: linear-gradient(135deg, var(--orange), var(--purple)); color: white; border: none; padding: 16px; border-radius: 14px; width: 100%; font-weight: 700; cursor: pointer; font-size: 1rem; }
        
        .card { border-bottom: 1px solid #f0f0f0; padding: 25px 0; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card-img { width: 100%; border-radius: 20px; margin: 15px 0; object-fit: cover; }
    </style>
</head>
<body>

<div id="slideshow"></div>
<div class="vignette"></div>
<div id="butterfly-layer"></div>

<div class="hero">
    <h1 class="eb-logo">EB</h1>
    <div class="main-counters">
        <div class="counter-item">
            <span class="counter-num" id="d-group" style="color: var(--orange);">0</span>
            <span class="counter-label">è´è¶èª•ç”Ÿ</span>
        </div>
        <div style="width: 1px; height: 40px; background: rgba(0,0,0,0.1);"></div>
        <div class="counter-item">
            <span class="counter-num" id="d-follow" style="color: var(--pink);">0</span>
            <span class="counter-label">èˆ‡å¦³ç›¸é‡</span>
        </div>
    </div>
</div>

<nav class="nav-bar">
    <button class="nav-btn" onclick="toggleModal('m-timeline')">å›æ†¶</button>
    <button class="nav-btn" onclick="toggleModal('m-plan')">è¡Œç¨‹</button>
    <button class="nav-btn" onclick="toggleModal('m-radar')">é­…åŠ›</button>
    <button class="nav-btn admin" onclick="toggleModal('m-admin')">è¨­å®š</button>
</nav>

<div id="m-timeline" class="modal">
    <div class="modal-header"><h2>å›æ†¶æ™‚å…‰æ©Ÿ</h2><button class="close-btn" onclick="toggleModal('m-timeline')">âœ•</button></div>
    <div class="content" id="list-timeline"></div>
</div>

<div id="m-plan" class="modal">
    <div class="modal-header"><h2>è´è¶è¡Œç¨‹è¡¨</h2><button class="close-btn" onclick="toggleModal('m-plan')">âœ•</button></div>
    <div class="content" id="list-plans"></div>
</div>

<div id="m-radar" class="modal">
    <div class="modal-header"><h2>é­…åŠ›è§€æ¸¬</h2><button class="close-btn" onclick="toggleModal('m-radar')">âœ•</button></div>
    <div class="content">
        <select id="radarTarget" onchange="initRadarChart()"><option value="emi">EMI ğŸŠ</option><option value="bonnie">BONNIE ğŸ’œ</option></select>
        <div style="padding: 20px; background: #fff; border-radius: 20px;"><canvas id="radarChart"></canvas></div>
    </div>
</div>

<div id="m-admin" class="modal">
    <div class="modal-header"><h2>ç³»çµ±è¨­å®š</h2><button class="close-btn" onclick="toggleModal('m-admin')">âœ•</button></div>
    <div class="content">
        <div class="section-box">
            <label>ğŸ“¸ æ›´æ›èƒŒæ™¯ç…§ç‰‡ (å¯å¤šé¸)</label>
            <input type="file" id="up-bg" multiple accept="image/*">
        </div>
        <div class="section-box">
            <label>ğŸ‚ ç´€å¿µæ—¥è¨­å®š</label>
            <input type="date" id="in-group" oninput="saveSystem()">
            <input type="date" id="in-follow" oninput="saveSystem()">
        </div>
        <div class="section-box">
            <label>âœï¸ æ–°å¢å›æ†¶</label>
            <input type="date" id="in-tl-date"><input type="text" id="in-tl-title" placeholder="å›æ†¶ä¸»é¡Œ">
            <textarea id="in-tl-desc" rows="3" placeholder="å…·é«”ç´°ç¯€..."></textarea>
            <input type="file" id="in-tl-img">
            <button class="btn-submit" onclick="addData('timeline')">ä¿å­˜åˆ°æ™‚é–“è»¸</button>
        </div>
        <div class="section-box">
            <label>ğŸ“ æ–°å¢è¡Œç¨‹</label>
            <input type="date" id="in-p-date"><input type="text" id="in-p-title" placeholder="æ´»å‹•æ¨™é¡Œ">
            <input type="file" id="in-p-img">
            <button class="btn-submit" onclick="addData('plan')">å„²å­˜è¡Œç¨‹</button>
        </div>
        <button onclick="if(confirm('æ¸…ç©ºæ•¸æ“šï¼Ÿ')) {localStorage.clear();location.reload();}" style="color: #ff4d4d; border:none; background:none; width:100%; padding:20px; cursor:pointer;">âš ï¸ æ¸…ç©ºæ‰€æœ‰è³‡æ–™</button>
    </div>
</div>

<script>
    let db = { tl: [], plans: [], slides: [] }, radar;

    // --- æ ¸å¿ƒå·¥å…· ---
    const toggleModal = (id) => document.getElementById(id).classList.toggle('active');
    const getBase64 = (file) => new Promise(res => { if(!file) return res(null); const r = new FileReader(); r.readAsDataURL(file); r.onload = () => res(r.result); });

    // --- ç³»çµ±åŠŸèƒ½ ---
    function saveSystem() {
        localStorage.setItem('eb_g', document.getElementById('in-group').value);
        localStorage.setItem('eb_f', document.getElementById('in-follow').value);
        renderHome();
    }

    async function addData(type) {
        if(type === 'timeline') {
            const img = await getBase64(document.getElementById('in-tl-img').files[0]);
            db.tl.unshift({ date: document.getElementById('in-tl-date').value, title: document.getElementById('in-tl-title').value, desc: document.getElementById('in-tl-desc').value, img });
            localStorage.setItem('eb_tl', JSON.stringify(db.tl));
        } else {
            const img = await getBase64(document.getElementById('in-p-img').files[0]);
            db.plans.push({ date: document.getElementById('in-p-date').value, title: document.getElementById('in-p-title').value, img });
            db.plans.sort((a,b) => a.date.localeCompare(b.date));
            localStorage.setItem('eb_p', JSON.stringify(db.plans));
        }
        alert('å­˜å„²æˆåŠŸ âœ¨'); renderLists();
    }

    function renderHome() {
        const g = localStorage.getItem('eb_g'), f = localStorage.getItem('eb_f'), now = new Date();
        if(g) { document.getElementById('d-group').innerText = Math.floor((now - new Date(g))/86400000); document.getElementById('in-group').value = g; }
        if(f) { document.getElementById('d-follow').innerText = Math.floor((now - new Date(f))/86400000); document.getElementById('in-follow').value = f; }
    }

    function renderLists() {
        document.getElementById('list-timeline').innerHTML = db.tl.map((i, idx) => `
            <div class="card">
                <small style="color:var(--pink); font-weight:700;">${i.date}</small>
                <h3 style="margin:8px 0;">${i.title}</h3>
                ${i.img ? `<img src="${i.img}" class="card-img">` : ''}
                <p style="color:#666; font-size:0.95rem; line-height:1.6;">${i.desc}</p>
                <button onclick="del('tl',${idx})" style="border:none; background:none; color:#ddd; font-size:0.7rem; cursor:pointer;">åˆªé™¤</button>
            </div>`).join('');

        document.getElementById('list-plans').innerHTML = db.plans.map((i, idx) => `
            <div class="card">
                <div style="color:var(--orange); font-weight:700;">${i.date}</div>
                <h3 style="margin:8px 0;">${i.title}</h3>
                ${i.img ? `<img src="${i.img}" class="card-img">` : ''}
                <button onclick="del('p',${idx})" style="border:none; background:none; color:#ddd; font-size:0.7rem; cursor:pointer;">åˆªé™¤</button>
            </div>`).join('');
    }

    function del(type, i) { if(type==='tl'){db.tl.splice(i,1);localStorage.setItem('eb_tl', JSON.stringify(db.tl));}else{db.plans.splice(i,1);localStorage.setItem('eb_p',JSON.stringify(db.plans));} renderLists(); }

    function initRadarChart() {
        if(radar) radar.destroy();
        const ctx = document.getElementById('radarChart').getContext('2d');
        const target = document.getElementById('radarTarget').value;
        radar = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['å¯æ„›', 'å¸¥æ°£', 'æ­Œè²', 'ç¶œè—', 'å¯µç²‰'],
                datasets: [{ data: [90, 85, 95, 80, 98], borderColor: target==='emi'?'#f37021':'#662d91', backgroundColor: 'rgba(255,183,197,0.1)', borderWidth: 2 }]
            },
            options: { plugins: { legend: { display: false } } }
        });
    }

    // --- èƒŒæ™¯èˆ‡å‹•ç•« ---
    document.getElementById('up-bg').onchange = async function(e) {
        db.slides = [];
        for(let f of e.target.files) db.slides.push(await getBase64(f));
        localStorage.setItem('eb_slides', JSON.stringify(db.slides));
        location.reload();
    };

    function startSlides() {
        const box = document.getElementById('slideshow');
        const saved = JSON.parse(localStorage.getItem('eb_slides')) || [];
        if(!saved.length) box.innerHTML = `<div class="slide active" style="background-image:url('https://images.unsplash.com/photo-1494972308255-023c550c8188?q=80&w=2000')"></div>`;
        else {
            box.innerHTML = saved.map((s,i) => `<div class="slide ${i===0?'active':''}" style="background-image:url('${s}')"></div>`).join('');
            let cur = 0; setInterval(() => {
                const s = document.querySelectorAll('.slide'); if(s.length<2) return;
                s[cur].classList.remove('active'); cur = (cur+1)%s.length; s[cur].classList.add('active');
            }, 6000);
        }
    }

    function startButterflies() {
        const layer = document.getElementById('butterfly-layer');
        setInterval(() => {
            const b = document.createElement('div');
            b.className = 'butterfly';
            b.innerHTML = 'ğŸ¦‹';
            b.style.left = Math.random() * 100 + 'vw';
            b.style.animationDuration = (Math.random() * 10 + 10) + 's';
            b.style.color = Math.random() > 0.5 ? '#ffb7c5' : '#f37021';
            layer.appendChild(b);
            setTimeout(() => b.remove(), 15000);
        }, 4000);
    }

    window.onload = () => {
        db.tl = JSON.parse(localStorage.getItem('eb_tl')) || [];
        db.plans = JSON.parse(localStorage.getItem('eb_p')) || [];
        renderHome(); renderLists(); startSlides(); startButterflies();
        document.getElementById('in-tl-date').valueAsDate = new Date();
        document.getElementById('in-p-date').valueAsDate = new Date();
    };
</script>
</body>
</html>

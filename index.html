<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EmiBonnie - Butterfly Eternal</title>
    <style>
        :root {
            --emi: #f37021; --bonnie: #662d91; --any: #ff85a2;
            --grad: linear-gradient(135deg, #f37021, #662d91);
            --eb: linear-gradient(135deg, #f37021, #662d91);
            --eba: linear-gradient(135deg, #f37021, #662d91, #ff85a2);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #fff; font-family: -apple-system, "PingFang TC", sans-serif; overflow: hidden; }

        /* éœ§åŒ–èƒŒæ™¯èˆ‡æ‰‹ç¹ªè´è¶ */
        .mist-bg {
            position: fixed; inset: 0; z-index: 0;
            background: 
                radial-gradient(circle at 15% 15%, rgba(243, 112, 33, 0.1), transparent 45%),
                radial-gradient(circle at 85% 85%, rgba(102, 45, 145, 0.1), transparent 45%),
                radial-gradient(circle at 50% 50%, rgba(255, 133, 162, 0.08), transparent 65%);
            filter: blur(30px);
        }

        .butterfly {
            position: absolute; width: 18px; height: 18px;
            background: var(--grad); border-radius: 50% 50% 0 50%;
            transform: rotate(45deg); opacity: 0.25; filter: blur(1px);
            animation: float 12s infinite ease-in-out; z-index: 1;
        }
        .butterfly::after {
            content: ''; position: absolute; width: 18px; height: 18px;
            background: var(--grad); border-radius: 50% 50% 50% 0;
            left: -10px; top: -10px;
        }
        @keyframes float { 0%, 100% { transform: translate(0,0) rotate(45deg); } 50% { transform: translate(30px, -40px) rotate(60deg); } }

        /* é¦–é æ¨™é¡Œ */
        .home-hero { position: fixed; top: 18%; width: 100%; text-align: center; z-index: 2; }
        .main-title { 
            font-size: 4.2rem; font-weight: 900; letter-spacing: -2px;
            background: linear-gradient(to right, #f37021, #662d91);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 0px; text-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        .sub-title { font-size: 0.75rem; letter-spacing: 5px; color: #aaa; margin-bottom: 40px; font-weight: 800; }

        .dday-box { display: flex; justify-content: center; gap: 18px; }
        .dday-item {
            background: rgba(255, 255, 255, 0.75); padding: 22px; border-radius: 20px 55px 20px 55px;
            backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 12px 35px rgba(0,0,0,0.06); cursor: pointer;
        }

        /* å°è¦½åˆ— */
        .nav-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 94%; max-width: 650px; }
        .main-nav { 
            background: rgba(255, 255, 255, 0.88); padding: 10px; border-radius: 40px; 
            backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.7);
            display: flex; overflow-x: auto; scrollbar-width: none;
        }
        .nav-btn { background: transparent; border: none; font-size: 0.9rem; font-weight: 800; color: #777; padding: 10px 18px; flex-shrink: 0; }
        .nav-btn.active-tab { color: var(--emi); transform: scale(1.1); }

        /* æ¨¡æ…‹æ¡†é€šç”¨ */
        .modal { position: fixed; inset: 0; background: rgba(255, 255, 255, 0.96); z-index: 500; transform: translateY(100%); transition: 0.5s cubic-bezier(0.1, 0.9, 0.2, 1); overflow-y: auto; padding-bottom: 140px; }
        .modal.active { transform: translateY(0); }
        .header { position: sticky; top: 0; background: #fff; padding: 18px 25px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; border-bottom: 1px solid #f0f0f0; }

        /* ç¯©é¸åˆ— */
        .filter-group { background: #fff; position: sticky; top: 60px; z-index: 999; padding-bottom: 5px; }
        .year-bar { display: flex; gap: 10px; padding: 10px 20px; overflow-x: auto; scrollbar-width: none; }
        .year-btn { padding: 8px 18px; border-radius: 20px; background: #f0f0f0; border: none; font-weight: 800; color: #999; white-space: nowrap; font-size: 0.8rem; }
        .year-btn.active { background: var(--grad); color: #fff; }

        /* æ‹ç«‹å¾— (ç”±ä¸‹å¾€ä¸Šã€å·¦å¾€å³) */
        .polaroid-grid { display: flex; flex-wrap: wrap; gap: 15px; padding: 20px; align-items: flex-end; }
        .polaroid {
            background: #fff; padding: 12px 12px 35px 12px; width: calc(50% - 8px); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); transform: rotate(calc(-2deg + 4deg * Math.random()));
            border: 1px solid #eee; position: relative;
        }
        .polaroid img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border: 1px solid #f9f9f9; }
        .p-info { margin-top: 15px; text-align: center; }
        .p-title { font-size: 0.95rem; font-weight: 800; color: #333; }
        .p-date { font-size: 0.75rem; color: #aaa; font-family: monospace; margin-top: 4px; }

        /* éšæ¢¯è»Œè·¡ */
        .tl-container { position: relative; padding: 40px 15px; }
        .tl-container::before { content: ''; position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: var(--grad); transform: translateX(-50%); opacity: 0.2; }
        .tl-item { position: relative; width: 100%; margin-bottom: 40px; display: flex; justify-content: flex-end; }
        .tl-item:nth-child(even) { justify-content: flex-start; }
        .tl-dot { position: absolute; left: 50%; top: 20px; width: 15px; height: 15px; background: #fff; border: 4px solid var(--emi); border-radius: 50%; transform: translateX(-50%); z-index: 2; }
        .tl-card { width: 45%; background: #fff; border-radius: 18px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); padding: 12px; border: 1px solid #f0f0f0; cursor: pointer; }

        /* æœˆæ›†ç¶“å…¸ç‰ˆ */
        .cal-ctrl { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 15px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #eee; margin: 0 12px; border-radius: 15px; overflow: hidden; border: 1px solid #eee; }
        .cal-day { background: #fff; min-height: 95px; padding: 8px; font-size: 0.75rem; }
        .ev-tag { font-size: 0.55rem; padding: 2px 4px; border-radius: 4px; color: #fff; margin-top: 2px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .tag-emi { background: var(--emi); } .tag-bonnie { background: var(--bonnie); } .tag-any { background: var(--any); }
        .tag-emibonnie { background: var(--eb); } .tag-emibonnieany { background: var(--eba); }

        /* ç·¨è¼¯å€åŸŸ */
        .edit-zone { background: #fdfdfd; padding: 20px; border-radius: 25px; margin: 15px; display: none; border: 1px dashed var(--emi); }
        input, select, textarea { width: 100%; padding: 12px; margin: 6px 0; border-radius: 12px; border: 1px solid #eee; background: #f9f9f9; }
        .btn-post { background: var(--grad); color: #fff; border: none; padding: 15px; width: 100%; border-radius: 15px; font-weight: 800; margin-top: 10px; }
        
        #day-pop { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; z-index: 2000; padding: 30px; border-radius: 35px 35px 0 0; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); display: none; }
    </style>
</head>
<body>

<div class="mist-bg"></div>
<div class="butterfly" style="top:10%; left:5%;"></div>
<div class="butterfly" style="top:35%; left:88%; animation-delay: 2s;"></div>
<div class="butterfly" style="top:75%; left:15%; animation-delay: 4s;"></div>

<div class="home-hero">
    <h1 class="main-title">EmiBonnie</h1>
    <div class="sub-title">BUTTERFLY MEMORIES</div>
    <div class="dday-box">
        <div class="dday-item" onclick="editSysDate('born')">
            <div style="font-size:0.7rem; color:#999; margin-bottom:5px;">è´è¶èª•ç”Ÿ</div>
            <span id="d1" style="font-size:2.8rem; font-weight:900; color:var(--emi);">0</span>
        </div>
        <div class="dday-item" onclick="editSysDate('meet')">
            <div style="font-size:0.7rem; color:#999; margin-bottom:5px;">èˆ‡ä½ ç›¸é‡</div>
            <span id="d2" style="font-size:2.8rem; font-weight:900; color:var(--bonnie);">0</span>
        </div>
    </div>
</div>

<div class="nav-container">
    <nav class="main-nav">
        <div style="padding:0 18px; cursor:pointer; font-size:1.5rem;" onclick="closeAll()">ğŸ¦‹</div>
        <button class="nav-btn" onclick="openM('m-works', this)">ä½œå“</button>
        <button class="nav-btn" onclick="openM('m-timeline', this)">è»Œè·¡</button>
        <button class="nav-btn" onclick="openM('m-coll', this)">çè—</button>
        <button class="nav-btn" onclick="openM('m-plans', this)">è¡Œç¨‹</button>
        <button class="nav-btn" onclick="openM('m-profile', this)">åç‰Œ</button>
        <button class="nav-btn" onclick="openM('m-diary', this)">æ—¥è¨˜</button>
    </nav>
</div>

<div id="m-works" class="modal">
    <div class="header"><b>ä½œå“é›†</b><div style="font-size:2rem;" onclick="toggleEdit('w-edit')">ï¼‹</div></div>
    <div class="filter-group">
        <div id="w-year-bar" class="year-bar"></div>
        <div class="year-bar" style="padding-top:0;">
            <button class="year-btn active" onclick="setCat('w','å…¨éƒ¨',this)">å…¨éƒ¨</button>
            <button class="year-btn" onclick="setCat('w','å½±è¦–',this)">å½±è¦–</button>
            <button class="year-btn" onclick="setCat('w','éŸ³æ¨‚',this)">éŸ³æ¨‚</button>
            <button class="year-btn" onclick="setCat('w','æ¼”å‡º',this)">æ¼”å‡º</button>
        </div>
    </div>
    <div id="w-edit" class="edit-zone">
        <input type="text" id="w-n" placeholder="é¡Œç›®">
        <input type="date" id="w-d">
        <select id="w-c"><option value="å½±è¦–">å½±è¦–</option><option value="éŸ³æ¨‚">éŸ³æ¨‚</option><option value="æ¼”å‡º">æ¼”å‡º</option></select>
        <input type="text" id="w-l" placeholder="å¹³å°/åœ°é»">
        <textarea id="w-t" placeholder="è©³ç´°æè¿°..."></textarea>
        <input type="file" id="w-i">
        <button class="btn-post" onclick="handleNew('works', 'w')">ç™¼å¸ƒæ‹ç«‹å¾—</button>
    </div>
    <div id="w-render" class="polaroid-grid"></div>
</div>

<div id="m-timeline" class="modal">
    <div class="header"><b>æˆé•·è»Œè·¡</b><div style="font-size:2rem;" onclick="toggleEdit('tl-edit')">ï¼‹</div></div>
    <div id="tl-year-bar" class="year-bar"></div>
    <div id="tl-edit" class="edit-zone">
        <input type="text" id="tl-n" placeholder="æ¨™é¡Œ">
        <input type="date" id="tl-d">
        <input type="text" id="tl-l" placeholder="ç™¼ç”Ÿåœ°é»">
        <textarea id="tl-t" placeholder="å…§å®¹ç´°ç¯€..."></textarea>
        <input type="file" id="tl-i">
        <button class="btn-post" onclick="handleNew('timeline', 'tl')">æ–°å¢è»Œè·¡</button>
    </div>
    <div id="tl-render" class="tl-container"></div>
</div>

<div id="m-coll" class="modal">
    <div class="header"><b>çè—é¤¨</b><div style="font-size:2rem;" onclick="toggleEdit('co-edit')">ï¼‹</div></div>
    <div id="co-year-bar" class="year-bar"></div>
    <div id="co-edit" class="edit-zone">
        <input type="text" id="co-n" placeholder="é¡Œç›®">
        <input type="date" id="co-d">
        <textarea id="co-t" placeholder="çè—å…§å®¹..."></textarea>
        <input type="file" id="co-i">
        <button class="btn-post" onclick="handleNew('colls', 'co')">å…¥åº«çè—</button>
    </div>
    <div id="co-render" class="polaroid-grid"></div>
</div>

<div id="m-plans" class="modal">
    <div class="header"><b>è¡Œç¨‹æœˆæ›†</b><span onclick="closeAll()">âœ•</span></div>
    <div class="cal-ctrl">
        <select id="cal-year" onchange="jumpDate()"></select>
        <select id="cal-month" onchange="jumpDate()"></select>
        <button class="nav-btn" onclick="changeMonth(-1)">â—€</button>
        <button class="nav-btn" onclick="changeMonth(1)">â–¶</button>
    </div>
    <div class="cal-grid" id="cal-body"></div>
</div>

<div id="m-profile" class="modal">
    <div class="header"><b>æˆå“¡åç‰Œ</b><span onclick="closeAll()">âœ•</span></div>
    <div style="display:flex; justify-content:center; gap:10px; padding:20px;">
        <button class="year-btn active" onclick="renderProfile('emi')">Emi</button>
        <button class="year-btn" onclick="renderProfile('bonnie')">Bonnie</button>
        <button class="year-btn" onclick="renderProfile('any')">Any</button>
    </div>
    <div id="p-render" style="text-align:center;"></div>
</div>

<div id="m-diary" class="modal">
    <div class="header"><b>è´è¶æ—¥è¨˜</b><div style="font-size:2rem;" onclick="toggleEdit('dy-edit')">ï¼‹</div></div>
    <div id="dy-edit" class="edit-zone"><textarea id="dy-t" placeholder="å¿ƒæƒ…..."></textarea><button class="btn-post" onclick="handleNew('diaries','dy')">å¯«ä¸‹</button></div>
    <div id="dy-render" style="padding:20px;"></div>
</div>

<div id="day-pop">
    <h3 id="pop-date"></h3>
    <div id="pop-list"></div>
    <select id="pop-who">
        <option value="emi">Emi (æ©˜)</option><option value="bonnie">Bonnie (ç´«)</option>
        <option value="any">Any (ç²‰)</option><option value="emibonnieany">å…¨é«”</option>
    </select>
    <input type="text" id="pop-new-ev" placeholder="æ–°è¡Œç¨‹...">
    <button class="btn-post" onclick="quickAddPlan()">ç¢ºèªæ–°å¢</button>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('eb_final_v99')) || {
        settings: { born: "2024-01-01", meet: "2024-05-20" },
        profiles: { emi: { bio: "Emi...", img: "" }, bonnie: { bio: "Bonnie...", img: "" }, any: { bio: "Any...", img: "" } },
        works: [], timeline: [], colls: [], plans: [], diaries: []
    };

    let curY = { w: '2026', tl: '2026', co: '2026' };
    let curCat = 'å…¨éƒ¨';
    let viewDate = new Date();

    const save = () => { localStorage.setItem('eb_final_v99', JSON.stringify(db)); renderHome(); };
    const toBase64 = f => new Promise(r => { if(!f) r(""); else { const rd=new FileReader(); rd.onload=e=>r(e.target.result); rd.readAsDataURL(f); } });

    function toggleEdit(id) {
        const el = document.getElementById(id);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    async function handleNew(type, prefix) {
        const img = await toBase64(document.getElementById(prefix+'-i')?.files[0]);
        const dVal = document.getElementById(prefix+'-d')?.value || new Date().toISOString().split('T')[0];
        const data = {
            id: Date.now(),
            n: document.getElementById(prefix+'-n')?.value || "ç„¡æ¨™é¡Œ",
            d: dVal,
            c: document.getElementById(prefix+'-c')?.value || "é€šç”¨",
            l: document.getElementById(prefix+'-l')?.value || "",
            t: document.getElementById(prefix+'-t')?.value || document.getElementById(prefix+'-t')?.innerText || "",
            i: img,
            y: dVal.split('-')[0]
        };
        db[type].push(data);
        save();
        toggleEdit(prefix+'-edit');
        refreshView(type, prefix);
    }

    function refreshView(type, prefix) {
        if(type === 'timeline') renderTimeline();
        else if(type === 'works' || type === 'colls') renderPolaroids(type, prefix);
        else if(type === 'diaries') openM('m-diary');
    }

    function renderPolaroids(type, prefix) {
        const container = document.getElementById(prefix + '-render');
        const years = [...new Set(db[type].map(i => i.y))].sort((a,b)=>b-a);
        if(!years.includes(curY[prefix])) curY[prefix] = years[0] || '2026';

        document.getElementById(prefix+'-year-bar').innerHTML = years.map(y => `
            <button class="year-btn ${curY[prefix]===y?'active':''}" onclick="curY['${prefix}']='${y}'; renderPolaroids('${type}','${prefix}')">${y}å¹´</button>
        `).join('');

        let list = db[type].filter(i => i.y === curY[prefix]);
        if(type === 'works' && curCat !== 'å…¨éƒ¨') list = list.filter(i => i.c === curCat);

        container.innerHTML = [...list].reverse().map(i => `
            <div class="polaroid" onclick="alert('${i.t}')">
                <img src="${i.i || 'https://via.placeholder.com/200'}">
                <div class="p-info">
                    <div class="p-title">${i.n}</div>
                    <div class="p-date">${i.d.replace(/-/g,'.')}</div>
                </div>
                <button onclick="event.stopPropagation(); delData('${type}','${prefix}',${i.id})" style="position:absolute; top:5px; right:5px; border:none; background:rgba(0,0,0,0.1); color:#fff; border-radius:50%; width:20px; height:20px; font-size:10px;">âœ•</button>
            </div>
        `).join('');
    }

    function renderTimeline() {
        const container = document.getElementById('tl-render');
        const years = [...new Set(db.timeline.map(i => i.y))].sort((a,b)=>b-a);
        document.getElementById('tl-year-bar').innerHTML = years.map(y => `
            <button class="year-btn ${curY.tl===y?'active':''}" onclick="curY.tl='${y}'; renderTimeline()">${y}å¹´</button>
        `).join('');
        
        const list = db.timeline.filter(i => i.y === (curY.tl || '2026'));
        container.innerHTML = list.map((i, idx) => `
            <div class="tl-item">
                <div class="tl-dot"></div>
                <div class="tl-card" onclick="this.querySelector('.full').style.display='block'">
                    <small style="color:var(--emi); font-weight:800;">${i.d}</small>
                    <div style="font-weight:800; margin-top:5px;">${i.n}</div>
                    ${i.i ? `<img src="${i.i}" style="width:100%; margin-top:10px; border-radius:10px;">` : ''}
                    <div class="full" style="display:none; font-size:0.8rem; color:#666; margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                        ğŸ“ ${i.l}<br>${i.t}<br>
                        <small onclick="event.stopPropagation(); delData('timeline','tl',${i.id})" style="color:red">[åˆªé™¤]</small>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function renderCal() {
        const y = viewDate.getFullYear(), m = viewDate.getMonth();
        document.getElementById('cal-year').value = y; document.getElementById('cal-month').value = m;
        const first = new Date(y, m, 1).getDay(), days = new Date(y, m+1, 0).getDate();
        let h = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].map(d => `<div style="text-align:center; padding:5px; font-size:0.7rem; color:#bbb;">${d}</div>`).join('');
        for(let i=0; i<first; i++) h += `<div></div>`;
        for(let d=1; d<=days; d++) {
            const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const evs = db.plans.filter(p => p.date === ds);
            h += `<div class="cal-day" onclick="showPop('${ds}')"><b>${d}</b>${evs.map(e => `<span class="ev-tag tag-${e.who}">${e.txt}</span>`).join('')}</div>`;
        }
        document.getElementById('cal-body').innerHTML = h;
    }

    function showPop(d) {
        document.getElementById('pop-date').innerText = d;
        const evs = db.plans.filter(p => p.date === d);
        document.getElementById('pop-list').innerHTML = evs.map((e, i) => `<div>â— ${e.txt} <small onclick="delPlan('${d}',${i})" style="color:red">âœ•</small></div>`).join('');
        document.getElementById('day-pop').style.display = 'block';
    }

    function quickAddPlan() {
        const d = document.getElementById('pop-date').innerText, w = document.getElementById('pop-who').value, t = document.getElementById('pop-new-ev').value;
        if(!t) return; db.plans.push({ date: d, who: w, txt: t });
        save(); renderCal(); showPop(d); document.getElementById('pop-new-ev').value = '';
    }

    function delPlan(d, idx) { db.plans = db.plans.filter((p, i) => !(p.date === d && i === idx)); save(); renderCal(); showPop(d); }
    function delData(type, pre, id) { if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) { db[type] = db[type].filter(x => x.id !== id); save(); refreshView(type, pre); } }
    function setCat(pre, cat, btn) { curCat = cat; document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); renderPolaroids('works', 'w'); }
    function openM(id, btn) { 
        closeAll(); document.getElementById(id).classList.add('active'); 
        if(btn) btn.classList.add('active-tab');
        if(id==='m-works') renderPolaroids('works','w'); 
        if(id==='m-timeline') renderTimeline(); 
        if(id==='m-coll') renderPolaroids('colls','co');
        if(id==='m-plans') renderCal();
        if(id==='m-diary') document.getElementById('dy-render').innerHTML = db.diaries.map(d => `<div class="tl-card" style="width:100%; margin-bottom:10px;"><small>${d.d}</small><p>${d.t}</p></div>`).join('');
    }
    function closeAll() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab')); document.getElementById('day-pop').style.display='none'; }
    function editSysDate(k) { const v = prompt("ä¿®æ”¹æ—¥æœŸ (YYYY-MM-DD):", db.settings[k]); if(v){db.settings[k]=v; save();} }
    function jumpDate() { viewDate = new Date(document.getElementById('cal-year').value, document.getElementById('cal-month').value, 1); renderCal(); }
    function changeMonth(s) { viewDate.setMonth(viewDate.getMonth()+s); renderCal(); }
    function renderProfile(who) {
        const p = db.profiles[who];
        document.getElementById('p-render').innerHTML = `<div style="padding:40px;"><img src="${p.img || 'https://via.placeholder.com/150'}" style="width:120px; height:120px; border-radius:60px; border:4px solid var(--${who}); object-fit:cover;"><h2>${who.toUpperCase()}</h2><p>${p.bio}</p></div>`;
    }

    function renderHome() {
        const calc = d => Math.floor((new Date() - new Date(d)) / 86400000);
        document.getElementById('d1').innerText = calc(db.settings.born);
        document.getElementById('d2').innerText = calc(db.settings.meet);
    }

    window.onload = () => {
        const yS = document.getElementById('cal-year'), mS = document.getElementById('cal-month');
        for(let y=2024; y<=2026; y++) yS.add(new Option(y+'å¹´', y));
        for(let m=1; m<=12; m++) mS.add(new Option(m+'æœˆ', m-1));
        renderHome();
    };
</script>
</body>
</html>
















